<dom-module id="es-printout-detail">
	<style>
		:host {
			@apply(--vbox-layout);
		}
	</style>
	
	<template>
		<!--문서 출력 데이터 설정 정보 조회 -->
		<sc-ajax id="findListDocumentOutputSetup"
				 url="findListDocumentOutputSetup.do"
				 body="{{searchParam}}"
				 on-response="completeFindListDocumentOutputSetup">
	    </sc-ajax>
	    
	    <!-- 문서 출력 데이터 설정 정보 : 저장 -->
        <sc-ajax id="saveListDocumentOutputSetup"
                 url="saveListDocumentOutputSetup.do"
                 on-response="completeSaveListDocumentOutputSetup">
        </sc-ajax>

        <!-- 문서 출력 데이터 설정 정보 : 삭제 -->
        <sc-ajax id=deleteListDocumentOutputDataSetup
                 url="deleteListDocumentOutputDataSetup.do"
                 on-response="completeDeleteListDocumentOutputDataSetup">
        </sc-ajax>
	    
		<!-- 문서 출력 데이터 파라미터 정보 조회 -->
		<sc-ajax id="findListDocumentOutputDataParam"
				 url="findListDocumentOutputDataParam.do"
				 body="{{searchParam}}"
				 on-response="completeFindListDocumentOutputDataParam">
	    </sc-ajax>
	    
        <!-- 문서 출력 데이터 파라미터 정보 : 저장 -->
        <sc-ajax id="saveListDocumentOutputDataParam"
                 url="saveListDocumentOutputDataParam.do"
                 on-response="completeSaveListDocumentOutputDataParam">
        </sc-ajax>
        
	    <!-- 문서 출력 데이터 파라미터 정보 : 삭제 -->
        <sc-ajax id="deleteListDocumentOutputDataParam"
                 url="deleteListDocumentOutputDataParam.do"
                 on-response="completeDeleteListDocumentOutputDataParam">
        </sc-ajax>
	
		<div class="vbox flex-3">
            <!-- 문서 출력 데이터 설정 정보 그리드 -->
            <sc-grid id="gridPanelDocOutpDatSetup" class="flex" editable="true"  on-item-click="onItemClick" 
            		 validation-group="saveDocOutpDatSetupCode">
                <cc-grid-toolbar title-text="문서 인쇄 데이터 설정 정보">
                    <sc-button text="추가" on-click="onAddDocOutpDatSetup" auth-s></sc-button>
                    <sc-button text="삭제" on-click="onDeleteDocOutpDatSetup" auth-s></sc-button>
                    <sc-button text="저장" on-click="onSaveDocOutpDatSetup" auth-s></sc-button>
                </cc-grid-toolbar>
                <sc-grid-columns>
                    <sc-data-column data-field="doc_outp_dat_nm" 	header-text="문서 인쇄 데이터 명" 		width="140" text-align="center" max-length="18" item-editable-function="onDatSetupEditable" style-name="link" required="true"></sc-data-column>
                    <sc-data-column data-field="doc_outp_dat_expln" header-text="문서 인쇄 데이터 설명" 	width="200" text-align="left" 	max-length="60" editable="true"></sc-data-column>
                    <sc-data-column data-field="regr_id" 			header-text="등록자 아이디" 			width="100" text-align="center" max-length="60"></sc-data-column>
                    <sc-date-column data-field="reg_dttm" 			header-text="등록 일시" 				width="100" text-align="center" max-length="60"></sc-date-column>
                    <sc-data-column data-field="modr_id" 			header-text="수정자 아이디" 			width="100" text-align="center" max-length="60"></sc-data-column>
                    <sc-date-column data-field="mod_dttm" 			header-text="수정 일시" 				width="100" text-align="center" max-length="60"></sc-date-column>
                </sc-grid-columns>
                <sc-grid-fields>
                	<sc-grid-field data-field="doc_outp_uuid"></sc-grid-field>
                	<sc-grid-field data-field="doc_outp_dat_setup_uuid"></sc-grid-field>
                </sc-grid-fields>
            </sc-grid>
        </div>

        <div class="vbox flex-7">
            <!-- 문서 출력 데이터 파라미터 그리드 -->
            <sc-grid id="gridPanelDocOutpDatParm" editable="true" class="flex"
            		validation-group="saveDocOutpDatParmCode">
                <cc-grid-toolbar title-text="문서 인쇄 데이터 파라미터 정보">
                    <sc-button text="추가" on-click="onAddDocOutpDatParm" auth-s></sc-button>
                    <sc-button text="삭제" on-click="onDeleteDocOutpDatParm" auth-s></sc-button>
                    <sc-button text="저장" on-click="onSaveDocOutpDatParm" auth-s></sc-button>
                </cc-grid-toolbar>
                <sc-grid-columns>
                    <sc-data-column data-field="doc_outp_dat_parm_nm" 	 header-text="문서 인쇄 데이터 파라미터 명" 	width="200" text-align="center" max-length="20" editable="true" required="true"></sc-data-column>
                    <sc-data-column data-field="doc_outp_dat_parm_expln" header-text="문서 인쇄 데이터 파라미터 설명" 	width="200" text-align="left" 	max-length="60" editable="true"></sc-data-column>
                    <sc-data-column data-field="regr_id" 			 	 header-text="등록자 아이디" 	 		 		width="100" text-align="center" max-length="60"></sc-data-column>
                    <sc-date-column data-field="reg_dttm" 			 	 header-text="등록 일시" 		 		 	width="100" text-align="center" max-length="60"></sc-date-column>
                    <sc-data-column data-field="modr_id" 			 	 header-text="수정자 아이디" 	 		 		width="100" text-align="center" max-length="60"></sc-data-column>
                    <sc-date-column data-field="mod_dttm" 			 	 header-text="수정 일시" 		 		 	width="100" text-align="center" max-length="60"></sc-date-column>
                </sc-grid-columns>
	            <sc-grid-fields>
	            	<sc-grid-field data-field="doc_outp_uuid"></sc-grid-field>
	            	<sc-grid-field data-field="doc_outp_dat_setup_uuid"></sc-grid-field>
	            </sc-grid-fields>
            </sc-grid>
        </div>
	</template>
	
	<script>
		Polymer({
			is : 'es-printout-detail',
			properties : {
             	// 조회 조건
                searchParam: {
                    type: Object,
                    value: function () {
                        return {};
                    }
                }
			},
			
			formulas: {
                isEditableDatSetup: function() {
                    return (!UT.isEmpty(this.searchParam.doc_id));
                },
                
                isEditableDatParm: function() {
                    return (!UT.isEmpty(this.searchParam.doc_outp_dat_nm));
                }
            },
            
			initialized : function() {
	    		
	    	},
	    	
			load: function(data) {
				var me = this;
				me.set('searchParam', data);
				me.onFindListDocumentOutputSetup();
				me.onFindListDocumentOutputDataParam();
			},
			
			clear: function() {
                var me = this;
                me.reset();
            },
            
            onDatSetupEditable: function(data, item) {
                var me = this,
                    provider = me.$.gridPanelDocOutpDatSetup.getDataProvider();
                return (provider.getItemState(item.rowIndex) == "created");
            },
            
            /* 문서 출력 데이터 설정 정보 */
           	onFindListDocumentOutputSetup: function() {
            	var me = this;
            	UT.request(me.$.findListDocumentOutputSetup);
            },
            
            /* 문서 출력 데이터 설정 정보 후처리 */
            completeFindListDocumentOutputSetup: function(e, res) {
            	var me = this,
            		result = res.response;
            	
            	me.$.gridPanelDocOutpDatSetup.setDataProvider(result);
            },
            
            /* 데이터 셀 클릭 이벤트  */
			onItemClick: function(event) {
	    		var me = this,
	    			data = event.detail.data,
	    			item = event.detail.item,
					provider = event.detail.provider;
				
				if(provider.getItemState(item.rowIndex) == "created"){
					return;
				}
				
	    		if(item.dataField === "doc_outp_dat_nm") {
	    			me.set("searchParam", data);
	    			me.onFindListDocumentOutputDataParam(data);
	    			
	    		}
	    	},
	    	
	    	/* 추가 */
	    	onAddDocOutpDatSetup: function(data) {
	    		var me = this,
                	provider = me.$.gridPanelDocOutpDatSetup.getDataProvider();
				
	            if(!me.formula('isEditableDatSetup')) {
	                UT.alert(me.translate("STD.E1012",null,me.translate('문서 아이디')),null,true); //"'{0}'을(를) 선택하십시오"
	                return;
	            }
	
	            // 그리드 신규행 추가
	            provider.addItem({
	            	doc_outp_uuid: me.searchParam.doc_outp_uuid,		 
	            	doc_outp_dat_nm: "",
	            	doc_outp_dat_expln: "",
	            	regr_id: SCSessionManager.currentUser.usr_id
	            });
	    	},
	    	
	    	/* 저장 */
	    	onSaveDocOutpDatSetup: function() {
	    		var me = this;

                if(!me.formula('isEditableDatSetup')) {
                    UT.alert(me.translate("STD.E1012",null,me.translate('문서 아이디')),null,true); //"'{0}'을(를) 선택하십시오"
                    return;
                }
                
                if(!me.docOutpDatSetupValidation()) {
                    return;
                }
                
                var provider = me.$.gridPanelDocOutpDatSetup.getDataProvider(),
                	created = provider.getNewItems(),
                	updated = provider.getUpdateItems();

	            if(created.length + updated.length === 0) {
	                UT.alert("STD.N1700"); // "변경된 내용이 없습니다"
	                return;
	            }
	
	            UT.confirm("STD.N1200", function() { // 저장 하시겠습니까?
	                me.$.saveListDocumentOutputSetup.body = {
	                    insertList: created,
	                    updateList: updated
	                };
	                UT.request(me.$.saveListDocumentOutputSetup);
	            });
	    	},
	    	
	    	docOutpDatSetupValidation: function() {
                var me = this;
                var provider = me.$.gridPanelDocOutpDatSetup.getDataProvider(),
                	rows = provider.getItems();
                // 기본 validate
                if(!me.validate('saveDocOutpDatSetupCode')) {
                    UT.alert("STD.E0000"); // 입력하신 정보를 다시 확인하여 주세요.
                    return false;
                }
                
                var unique_check = {};
                for (var i=0, len = rows.length; i<len; i++) {
                    if(typeof unique_check[rows[i].doc_outp_dat_nm] == "undefined"){
                        unique_check[rows[i].doc_outp_dat_nm] = 0;
                    } else {
                        UT.alert(me.translate("STD.E1000",null, me.translate('문서 출력 데이터 설정 정보')),null,true); // "'{0}'에 동일한 값이 존재합니다"
                        return false;
                    }
                }
                return true;
            },
	    	
	    	/* 저장 완료 */
	    	completeSaveListDocumentOutputSetup: function() {
	    		var me = this,
                message = "STD.N1500"; // 저장하였습니다.

	            UT.alert(message, function() {
	                me.onFindListDocumentOutputSetup();
	            });
	    	},
	    	
	    	/* 삭제 */
	    	onDeleteDocOutpDatSetup: function() {
	    		var me = this,
	    			message = "STD.N1300", // 삭제 하시겠습니까?
	                provider = me.$.gridPanelDocOutpDatSetup.getDataProvider(),
	                checked = provider.selectionCheckedItems();

	            if (checked && checked.length > 0) {
		            UT.confirm(message, function() { 
		                var deleted = provider.removeItems();
		                if(UT.isNotEmpty(deleted)){
		                    me.$.deleteListDocumentOutputDataSetup.body = {
		                    	doc_outp_dat_parm_uuid: me.searchParam.doc_outp_dat_parm_uuid,
		                        deleteList: checked
		                    };
		                    UT.request(me.$.deleteListDocumentOutputDataSetup);
		                }
		            });
	            } else {
		            UT.alert("STD.N1600");
	            }
	    	},
	    	
	    	/* 삭제 완료 */
	    	completeDeleteListDocumentOutputDataSetup: function() {
	    		var me = this,
                message = "STD.N2500"; // 삭제하였습니다..

	            UT.alert(message, function() {
	                me.onFindListDocumentOutputSetup();
	                me.onFindListDocumentOutputDataParam();
	            });
	    	},
	    	
	    	/* 문서 출력 데이터 파라미터 정보 조회 */
	    	onFindListDocumentOutputDataParam: function() {
	    		var me = this;
	    		UT.request(me.$.findListDocumentOutputDataParam);
	    	},
	    	
	    	/* 문서 출력 데이터 파라미터 정보 조회 완료 */ 
	    	completeFindListDocumentOutputDataParam: function(e, res) {
	    		var me = this,
        			result = res.response;
        	
        		me.$.gridPanelDocOutpDatParm.setDataProvider(result);
	    		
	    	},
	    	
	    	/* 추가 */
	    	onAddDocOutpDatParm: function(data) {
	    		var me = this,
                	provider = me.$.gridPanelDocOutpDatParm.getDataProvider();

	            if(!me.formula('isEditableDatParm')) {
	                UT.alert(me.translate("STD.E1012",null,me.translate('문서 인쇄 데이터 명')),null,true); //"'{0}'을(를) 선택하십시오"
	                return;
	            }
	
	            provider.addItem({
	            	doc_outp_uuid: me.searchParam.doc_outp_uuid,
	            	doc_outp_dat_setup_uuid: me.searchParam.doc_outp_dat_setup_uuid,
	                doc_outp_dat_parm_nm: "",					
	                doc_outp_dat_parm_expln:"",	
	                regr_id: SCSessionManager.currentUser.usr_id
	            });
	    	},
	    	
	    	/* 저장 */
	    	onSaveDocOutpDatParm: function() {
	    		var me = this;
	    		var provider = me.$.gridPanelDocOutpDatParm.getDataProvider(),
	                created = provider.getNewItems(),
	                updated = provider.getUpdateItems();
				
                if(!me.datParmValidation()) {
                    return;
                }
	    		
	            if(created.length + updated.length === 0) {
	                UT.alert("STD.N1700"); // "변경된 내용이 없습니다"
	                return;
	            }
	
	            UT.confirm("STD.N1200", function() { // 저장 하시겠습니까?
	                me.$.saveListDocumentOutputDataParam.body = {
	                    insertList: created,
	                    updateList: updated
	                };
	                UT.request(me.$.saveListDocumentOutputDataParam);
	            });
	    		
	    	},
	    	
	    	datParmValidation: function() {
                var me = this;

                // 기본 validate
                if(!me.validate('saveDocOutpDatParmCode')) {
                    UT.alert("STD.E0000"); // 입력하신 정보를 다시 확인하여 주세요.
                    return false;
                }

                var provider = me.$.gridPanelDocOutpDatParm.getDataProvider(),
                    rows = provider.getItems();
                var unique_check = {};
                for (var i=0, len = rows.length; i<len; i++) {
                    if(typeof unique_check[rows[i].doc_outp_dat_parm_nm] == "undefined") {
                        unique_check[rows[i].doc_outp_dat_parm_nm] = 0;
                    } else {
                        UT.alert(me.translate("STD.E1000",null, me.translate('문서 출력 데이터 파라미터 정보')),null,true); // "'{0}'에 동일한 값이 존재합니다"
                        return false;
                    }
                }
                return true;
            },
	    	
	    	/* 저장 완료 */
	    	completeSaveListDocumentOutputDataParam: function() {
	    		var me = this,
                message = "STD.N1500"; // 저장하였습니다.

	            UT.alert(message, function() {
	                me.onFindListDocumentOutputDataParam();
	            });
	    	},
	    	
	    	/* 삭제 */
	    	onDeleteDocOutpDatParm: function() {
	    		var me = this,
	                provider = me.$.gridPanelDocOutpDatParm.getDataProvider(),
	                checked = provider.selectionCheckedItems(),
                	message = "STD.N1300"; // "삭제 하시겠습니까?"

	            if(checked.length === 0) {
	                UT.alert("STD.N1600");
	                return;
	            }
                
	            UT.confirm(message, function() {
                    var deleted = provider.removeItems();
                    if(UT.isNotEmpty(deleted)){
                        me.$.deleteListDocumentOutputDataParam.body = {
                            deleteList: checked
                        };
                        UT.request(me.$.deleteListDocumentOutputDataParam);
                    }
                });
	    	},
	    	
	    	/* 삭제 후 처리 */
	    	completeDeleteListDocumentOutputDataParam: function() {
	    		var me = this,
                message = "STD.N2500"; // 삭제하였습니다.

	            UT.alert(message, function(){
	                me.onFindListDocumentOutputDataParam();
	            });
	    	}
		})
	</script>
</dom-module>