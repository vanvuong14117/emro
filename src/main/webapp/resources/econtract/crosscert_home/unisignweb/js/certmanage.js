var __certmanage=function(a){var Y=function(p){function y(){if(!a.certsList)return null;for(var c=a.certsList,b=c.list.length,d=[],g=[],f=0;f<b;f++)if(null!=c.list[f]){expState="";var l=c.list[f].index,n=[];if(m==a.CONST.__PF_M_CLOUD.device&&c.list[f].cert){var e=c.list[f].cert;var h=a.usWebToolkit.util.decode64(e.oid);var t=a.usWebToolkit.util.decodeUtf8(a.usWebToolkit.util.decode64(e.subject_dn));e=expState=a.certUtil().getLocalDate(e.cert_end_date);var u=a.certUtil().getIssuerName(h)}else c.list[f].cert?(a.usWebToolkit.x509Certificate.parser(c.list[f].cert,"Base64"),h=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),t=a.usWebToolkit.x509Certificate.getSubjectName(),e=a.usWebToolkit.x509Certificate.getNotAfter(),expState=a.usWebToolkit.x509Certificate.getNotAfter(),u=a.certUtil().getIssuerName(h),"undefined"==u&&(u=a.certUtil().getO(t))):(h=c.list[f].info.policyOID,t=c.list[f].info.subject,e=c.list[f].info.notAfter.split(" ")[0],expState=c.list[f].info.notAfter.split(" ")[0],u=a.certUtil().getIssuerName(h));"undefined"==u&&(u=a.certUtil().getO(t));n[0]="";n[1]=a.certUtil().getCertType(h);n[2]=a.certUtil().getCN(t);n[3]=u;n[4]=a.certUtil().getLocalDate(e);n[5]=l;n[6]=a.certUtil().getExpirationStateValue(expState);"crosscert"==a.certUtil().getO(t).toLowerCase()?d.push(n):g.push(n)}return{list:d.concat(g)}}function x(c,b,d,g,f){if(a.CONST.__USFB_M_DISK.device>c||0>b||!d)return-1;if(document.getElementById("us-div-cert-manage")){var l=0,n=0;v=b;a.certsList&&(a.certsList=null);var e=document.getElementById("us-div-cert-manage-btns"),k=document.getElementById("us-div-cloud-manage-btns");a.CONST.__PF_M_CLOUD.device===c?(e.style.display="none",k.style.display="block"):(e.style.display=null!=p.args&&null!=p.args.type?"none":"block",k.style.display="none");h=!0;if(a.CONST.__PF_M_CLOUD.device===c)h=!1,a.CLOUD.getCloudCertsList(function(c){if(0!=c.resultCode)f(c.resultCode);else{var b=c.certsList.length;if(0<b){for(var d=[],e=0;e<b;e++){var g={};g.index=e+1;g.cert=c.certsList[e];g.path="Cloud";d[e]=g}a.certsList={list:d}}else a.certsList=null;f(n)}});else if(a.CONST.__PF_M_LS.device===c){a.PFSH||f(-1);try{a.PFSH.SelectStorage(1)}catch(A){f(-1)}try{a.PFSH.LoadAllCerts(document.domain)}catch(A){301E5===A.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}b=null;try{b=a.PFSH.GetUserCerts(document.domain),a.PFUC=b}catch(A){a.uiUtil().errMsgBox(A.message,A.code)}null!=b&&void 0!=b&&void 0!=b.length&&(l=b.length-1);if(0<l){g=[];for(e=0;e<l;e++){k=e+1;var t={};t.index=k;t.cert=b[k].signcert;t.path="LocalStorage";g[e]=t}a.certsList={list:g}}else a.certsList=null,n=0;f(n)}else if(c==a.CONST.__PF_M_SS.device&&a.CCPFSH())h=!1,a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.BSPKI,function(c,b){0==c&&a.CCPFSH().GetCertificateList(function(c,b){if(0==c){var d=0;(a.PFUC=b)&&(d=b.length-1);if(0<d){for(var e=[],n=0;n<d;n++){var g=n+1,l={};l.index=g;l.cert=b[g].signcert;l.path="BrowserSign";e[n]=l}a.certsList={list:e}}}f(c)})});else if(c==a.CONST.__PF_M_CLOUDSIGN.device){h=!1;if(p.CS_phoneNumber)z(p.CS_phoneNumber);else{var u=a.loadUI("phoneNumber")({type:"phoneNumber",args:null,onConfirm:function(a){__PhoneNumber=a;z(a);u.dispose()},onCancel:function(){u.dispose()}});u.show()}var z=function(c){a.uiUtil().loadingBox(!0,"us-div-list-load",0);a.PFCS().reqMemberInfo(c,function(b,d,e){if(0!=b)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),alert(d+"\n\nError Code [ "+b+" ]"),f(b),!1;b=parseInt(e.split("|")[0]);if(0<b)M(c);else{if(-1==b){b=a.loadUI("cloudsignservice");var n=b({type:"double",args:{pNumber:c},onCancel:function(){n.dispose(!0);a.uiUtil().loadingBox(!1,"us-div-list-load",0)}})}else b=a.loadUI("cloudsignservice"),n=b({type:"joinus",args:{pNumber:c},onCancel:function(){n.dispose(!0);a.uiUtil().loadingBox(!1,"us-div-list-load",0)}});n.show()}})},M=function(c){a.PFCS().reqGetCert(c,"MANAGEMENT",function(c,b,d){if(0!=c)return a.uiUtil().loadingBox(!1,"us-div-list-load",0),a.uiUtil().errMsgBox(b,c),f(c),!1;if(0<d.length){b=[];for(var e=0;e<d.length;e++){var n={};n.index=e+1;n.cert=d[e];n.path="CloudSign";b[e]=n}a.certsList={list:b}}f(c);a.uiUtil().loadingBox(!1,"us-div-list-load",0);return!0})}}else!a.uiUtil().isItPFDevice(c)&&4&a.ESVS.Mode?a.nimservice()?a.nimservice().GetAllUserCertListNum(c,b,g,function(b,e,n){if(m!=c)return h=!1;l=n;if(0==b)0<l?a.nimservice().GetAllUserCert(n,function(c,b){0==c?a.certsList={list:b}:a.uiUtil().errMsgBox(a.nimservice().GetLastErrorMessage(),c);a.uiUtil().loadingBox(!1,"us-div-list-load");f(c)}):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),f(0));else{if(c==a.CONST.__USFB_M_MOBILE.device&&61E6==b)return a.ERROR.Code=11003,a.ERROR.Message=d.IDS_MSGBOX_NOT_INSTALL_MOBILE,confirm(d.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)?(document.getElementById("us-cert-manage-cls-btn").click(),b="firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"),null==b&&a.uiUtil().msgBox(d.IDS_MSGBOX_BLOCK_POPUP_WINDOW),a.certsList=null,f(-1)):(a.certsList=null,a.uiUtil().loadingBox(!1,"us-div-list-load"),f(0)),!1;if(c==a.CONST.__USFB_M_SECUREDISK.device&&8005E4==b)return a.ERROR.Code=31001,a.ERROR.Message=d.IDS_MSGBOX_NOT_INSTALL_SD,confirm(d.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(b="firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"),null==b&&a.uiUtil().msgBox(d.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,f(-1),!1;-1!==l&&(a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage());f(-1);a.certsList=null;a.uiUtil().loadingBox(!1,"us-div-list-load")}}):(a.uiUtil().msgBox(d.IDS_MSGBOX_NIM_ERROR_UNLOAD),f(-1)):f(n)}}function E(c,b){if(!c||!b)return!1;if(!a.certsList)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var d=a.loadUI("certview")({type:null,args:{type:"Base64",idx:parseInt(k.selectedIndex()),cert:a.certsList.list[parseInt(k.selectedIndex())-1].cert},onConfirm:function(){d.dispose();c.focus()},onCancel:function(){d.dispose();c.focus()}});d.show();a.uiUtil().loadingBox(!1,"us-div-list-load");return!0}function U(c,b){4&a.ESVS.Mode&&(SSDialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{drivetype:"BACKUP_DRIVE"},onConfirm:function(d,g){SSDialog.dispose();certlistDialog=a.loadUI("certlistui")({type:"BACKUPED_CERT",args:{device:m,dn:""},onConfirm:function(d){if(0>=d)return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_RECOVER_ERROR),!1;PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(c){PWDialog.dispose();a.nimservice().RecoverFromUSB(1,d,c,function(d,e,f){certlistDialog.dispose();0==d?x(m,1,b,"",function(d){(d=y())?k.redrawList(d.list,d.list.length):k.redrawList(null,0);h=!1;c="";a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_RECOVER_SUCCESS)}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_RECOVER_ERROR))})},onCancel:function(){PWDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){c.dispose()},10)}});PWDialog.show()},onCancel:function(){certlistDialog.dispose();a.uiUtil().getUserCancelErrCodeNMsg()}});certlistDialog.show();a.uiUtil().loadingBox(!1,"us-div-cert-list-load")},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");SSDialog.dispose()}}),SSDialog.show())}function la(c,b){function d(c,b,d){a.nimservice().BackupToUSB(c,b,d,function(c,b){0===c?a.uiUtil().msgBox(f.IDS_MSGBOX_CERT_BACKUP_SUCCESS):a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_BACKUP_ERROR,c);d="";a.uiUtil().loadingBox(!1,"us-div-list-load")})}function g(c,b,f){PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(c){PWDialog.dispose();var e=parseInt(k.selectedIndex());a.nimservice().CheckPassword(m,v,e,c,!0,function(n,g){0==n?(SSDialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{drivetype:"BACKUP_DRIVE"},onConfirm:function(a,b){SSDialog.dispose();d(e,b,c)},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");SSDialog.dispose();b.focus()}}),SSDialog.show()):(c="",a.uiUtil().msgBox(""==g?f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD:g),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){b.dispose()},10))})},onCancel:function(){PWDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){b.dispose()},10)}});PWDialog.show()}var f=b,l=null;if(!a.certsList||0>=parseInt(k.selectedIndex()))return a.uiUtil().msgBox(f.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetBackupedDriveList(function(b,d,h){var e=h.length;if(0==b)if(0<e){b=[];for(d=0;d<e;d++){var n={};n.index=d+1;n.name=h[d];b[d]=n}l={list:b}}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(f.IDS_MSGBOX_NO_BACKDRIVE),!1;else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().errMsgBox(d,b),!1;g(l,c,f)});else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1}function aa(c,b,d){function g(c,b,d,g,l){if(a.CONST.__USFB_M_DISK.device===b||a.CONST.__USFB_M_HDD.device===b||a.CONST.__USFB_M_MOBILE.device===b||a.CONST.__USFB_M_SECUREDISK.device===b||a.CONST.__USFB_M_MOBILETOKEN.device===b)f(c,g,b,d,0),g="";else if(a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b){var e=null;e=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN";PINDialog=a.loadUI("pin")({type:e,args:null,onConfirm:function(a){f(c,g,b,d,a,l);g="";PINDialog.dispose()},onCancel:function(){g="";PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}});PINDialog.show()}else g="",a.uiUtil().loadingBox(!1,"us-div-list-load")}function f(b,c,f,g,h,z){1>b||a.CONST.__USFB_M_DISK.device>f||0>g||null==c||0>=c.length?a.uiUtil().loadingBox(!1,"us-div-list-load"):f==a.CONST.__USFB_M_HSMKEY.device?a.nimservice().EnvelopData("kmcert",b,c,null,"abcdefghijklmnopqrstuvwxyz1234567890",1,function(e,n,r){4503E4==e&&a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_INFO_NO_KMCERT);a.nimservice().CopyCert(b,c,f,g,h,function(e,f){if(0===e)a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_COPY_SUCCESS),d&&d(0,z,a.certUtil().getTheCertAttributes(a.certsList.list[b-1].cert,"Base64"));else switch(e){case 4823E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4013E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;case 4844E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:f=a.nimservice().GetLastErrorMessage();f=l.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+f;a.uiUtil().msgBox(f);break;default:e=a.nimservice().GetLastErrorCode(),a.uiUtil().errMsgBox(f?f:l.IDS_MSGBOX_CERT_COPY_ERROR,e)}c="";a.uiUtil().loadingBox(!1,"us-div-list-load")})}):a.nimservice().CopyCert(b,c,f,g,h,function(b,f){if(0===b)a.uiUtil().msgBox(l.IDS_MSGBOX_CERT_COPY_SUCCESS),d&&d(0);else switch(b){case 4823E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4013E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;case 4844E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(l.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(l.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:f=a.nimservice().GetLastErrorMessage();f=l.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+f;a.uiUtil().msgBox(f);break;default:b=a.nimservice().GetLastErrorCode(),a.uiUtil().errMsgBox(f?f:l.IDS_MSGBOX_CERT_COPY_ERROR,b)}c="";a.uiUtil().loadingBox(!1,"us-div-list-load")})}if(!c||!b)return!1;var l=b;if(!a.certsList)return a.uiUtil().msgBox(l.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;a.uiUtil().loadingBox(!0,"us-div-list-load",5);Dialog=a.loadUI("storageselect")({type:"CERT_COPY",args:{sourceDevice:m,sourceDrive:v},onConfirm:function(b,c,d){Dialog.dispose();PWDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(f){PWDialog.dispose();if(a.nimservice()){var e=parseInt(k.selectedIndex());a.CONST.__USFB_M_SMARTCARD.device!=m?a.nimservice().CheckPassword(m,v,e,f,!0,function(n,h){0==n?g(e,b,c,f,d):(f="",a.uiUtil().msgBox(""==h?l.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD:h),a.uiUtil().loadingBox(!1,"us-div-list-load"))}):g(e,b,c,f)}else f="",a.uiUtil().msgBox(l.IDS_MSGBOX_NIM_ERROR_UNLOAD),PWDialog.dispose(),a.uiUtil().loadingBox(!1,"us-div-list-load")},onCancel:function(){PWDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}});PWDialog.show()},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");c.focus()}});Dialog.show();return!0}function ba(c,b,d){if(!c||!b)return!1;if(!a.certsList)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var g=document.getElementById("us-cert-manage-pw-change-btn");Dialog=a.loadUI("changepassword")({type:null,args:null,onConfirm:function(c,l){Dialog.dispose();if(null==c||0>=c.length||null==l||0>=l.length)return a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_PLEASE_INPUT_PASSWORD),setTimeout(function(){g.focus()},10),!1;var f=parseInt(k.selectedIndex());if(1>f)return a.uiUtil().msgBox(b.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),setTimeout(function(){g.focus()},10),!1;if(a.uiUtil().isItPFDevice(m))try{var e=a.PFUC[f],T;var t=T=null;var u=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(e.signpri),z=a.usWebToolkit.pkcs8.checkUserCertPassword(u,c);if(!1===z){u=null;var p={code:-1,message:b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD};throw p;}t=a.usWebToolkit.pkcs8.changePassword(u,c,l,"Base64");u=null;if("undefined"!==typeof e.kmcert){u=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(e.kmpri);z=a.usWebToolkit.pkcs8.checkUserCertPassword(u,c);if(!1===z)throw u=null,p={code:-1,message:b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD},p;T=a.usWebToolkit.pkcs8.changePassword(u,c,l,"Base64")}u=null;try{var A={};A.signcert=e.signcert;A.signpri=t;null!==T&&(A.kmcert=e.kmcert,A.kmpri=T);a.CONST.__PF_M_LS.device===m?(a.PFSH.SaveUserCert(e.ca,A,document.domain,!1),e=A=null,x(m,v,b,"",function(c){(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1;a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS);setTimeout(function(){g.focus()},10)})):a.CCPFSH().SaveUserCert(e.ca,A,!1,function(c){0==c?(e=A=null,x(m,v,b,"",function(c){(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1;a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS);setTimeout(function(){g.focus()},10)})):(a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,c),setTimeout(function(){g.focus()},10))})}catch(r){switch(r.code){case 1E7:0<=r.detail.indexOf("115010")?a.uiUtil().msgBox(b.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,r.code);break;default:a.uiUtil().errMsgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR,r.code)}setTimeout(function(){g.focus()},10)}finally{}}catch(r){a.uiUtil().errMsgBox(r.message,r.code),setTimeout(function(){g.focus()},10)}finally{}else a.nimservice()?(f=parseInt(k.selectedIndex()),a.nimservice().CheckPassword(m,v,f,c,!0,function(e,n){0===e?a.nimservice().ChangePassword(f,c,l,function(c,f){0===c?(a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_SUCCESS),d&&d(0)):(c=a.nimservice().GetLastErrorCode(),a.uiUtil().errMsgBox(""==f?b.IDS_MSGBOX_CERT_CHANGE_PW_ERROR:f,c));a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){g.focus()},10)}):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(""==n?b.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD:n),setTimeout(function(){g.focus()},10))})):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),setTimeout(function(){g.focus()},10))},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(b.IDS_MSGBOX_CERT_CHANGE_PW_CANCEL);Dialog.dispose();setTimeout(function(){g.focus()},10)}});Dialog.show()}function ca(c,b,d){function g(c){a.certsList&&(a.certsList=null);x(m,v,n,"",function(c){(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1;a.uiUtil().msgBox(n.IDS_MSGBOX_CERT_DELETE_SUCCESS);d&&d(0)})}function f(c){var b=parseInt(k.selectedIndex());if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))a.nimservice()?a.CONST.__USFB_M_HSMKEY.device!=m?a.nimservice().CheckPassword(m,v,b,c,!1,function(d,f){0===d?l(b,c,null):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(""==f?n.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED:f))}):l(b,c,null):(a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(n.IDS_MSGBOX_NIM_ERROR_UNLOAD));else{if(a.CONST.__PF_M_LS.device===m&&!a.PFUC||a.CONST.__PF_M_SS.device===m&&!a.CCPFSH())return c="",!1;try{var d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[b].signpri),f=a.usWebToolkit.pkcs8.checkUserCertPassword(d,c);d="";!1===f?a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):l(b,c,null)}catch(M){a.uiUtil().errMsgBox(M.message,M.code)}finally{}a.uiUtil().loadingBox(!1,"us-div-list-load")}}function l(c,b,d){if("MPKI"==a.ESVS.PKI){if(1>c)return a.uiUtil().loadingBox(!1,"us-div-list-load"),!1}else if(1>c||null==b||0>=b.length)return a.uiUtil().loadingBox(!1,"us-div-list-load"),d&&d.dispose(),!1;if(a.CONST.__PF_M_LS.device===m){try{a.PFSH.DeleteUserCertByIndex(c,document.domain),g(b),d&&d.dispose(),b=""}catch(z){return a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_DELETE_ERROR,z.code),b="",d&&d.dispose(),!1}finally{}a.uiUtil().loadingBox(!1,"us-div-list-load")}else a.CONST.__PF_M_SS.device===m?a.CCPFSH().DeleteUserCertByIndex(c,function(c,f){0==c?g(b):a.uiUtil().msgBox(n.IDS_MSGBOX_CERT_DELETE_ERROR,c);d&&d.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}):a.nimservice().DeleteCert(c,b,function(c,f){a.uiUtil().loadingBox(!1,"us-div-list-load");d&&d.dispose();if(0===c)g(b);else{b="";switch(c){case 4823E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4904E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(n.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:c=a.nimservice().GetLastErrorCode(),a.uiUtil().errMsgBox(n.IDS_MSGBOX_CERT_DELETE_ERROR,c)}return!1}});return!0}if(!c||!b)return!1;var n=b;if(!a.certsList)return a.uiUtil().msgBox(n.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;if(confirm(n.IDS_CONFIRMBOX_WARNING_DELETE_CERT))if("MPKI"==a.ESVS.PKI)c=parseInt(k.selectedIndex()),l(c,"",null);else{c=null;c=a.CONST.__USFB_M_HSMKEY.device===m?a.loadUI("pin"):a.loadUI("password");var e=c({type:null,args:null,onConfirm:function(a){e.dispose();f(a)},onCancel:function(){e.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load")}});e.show()}return!0}function Y(c){var b=parseInt(k.selectedIndex()),d=a.certsList.list[b-1].cert.cert_id,g=a.loadUI("changepin")({type:"PIN_CLOUD",args:null,onConfirm:function(b,l){g.dispose();a.uiUtil().loadingBox(!0,"us-div-list-load",a.uiUtil().getErrorMessageLang().IDS_CLOUD_CHANGE_PIN);a.CLOUD.changePin(d,b,l,function(b){0!=b.resultCode?a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PIN_ERROR+", Code"+b.resultCode):a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PIN_SUCCESS);a.uiUtil().loadingBox(!1,"us-div-list-load")})},onCancel:function(){g.dispose();a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_CHANGE_PIN_CANCEL)}});g.show()}function ma(c){var b=parseInt(k.selectedIndex());b=a.certsList.list[b-1].cert.cert_id;a.uiUtil().loadingBox(!0,"us-div-list-load",a.uiUtil().getErrorMessageLang().IDS_CLOUD_DELETE);a.CLOUD.deleteCert(b,function(b){0!=b.resultCode?a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_DELETE_ERROR+", Code"+b.resultCode):a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_DELETE_SUCCESS);a.uiUtil().loadingBox(!1,"us-div-list-load");x(m,v,c,"",function(a){(a=y())?k.redrawList(a.list,a.list.length):k.redrawList(null,0);h=!1})})}function na(c){var b=parseInt(k.selectedIndex());b=a.certsList.list[b-1].cert.cert_id;a.uiUtil().loadingBox(!0,"us-div-list-load",a.uiUtil().getErrorMessageLang().IDS_CLOUD_UNLOCK);a.CLOUD.unlockCertificate(b,function(b){0!=b.resultCode?a.uiUtil().msgBox(c.IDS_MSGBOX_UNLOCK_CLOUD_CERT_ERROR+", Code"+b.resultCode):a.uiUtil().msgBox(c.IDS_MSGBOX_UNLOCK_CLOUD_CERT_SUCCESS);a.uiUtil().loadingBox(!1,"us-div-list-load")})}function oa(c){var b=parseInt(k.selectedIndex()),d=a.certsList.list[b-1].cert.cert_id,g=a.loadUI("pin")({type:"PIN_CLOUD",args:null,onConfirm:function(b){g.dispose();pwdDialog=a.loadUI("password")({type:null,args:null,onConfirm:function(f){pwdDialog.dispose();a.uiUtil().loadingBox(!0,"us-div-list-load",a.uiUtil().getErrorMessageLang().IDS_CLOUD_EXPORT);a.CLOUD.exportCert(d,b,f,function(b){if(0!=b.resultCode)a.uiUtil().msgBox(c.IDS_MSGBOX_EXPORT_CLOUD_CERT_ERROR+", Code"+b.resultCode);else{var d=b.signCert,g=b.signPri,l=b.kmCert?b.kmCert:null,h=b.kmPri?b.kmPri:null;b=null;try{a.usWebToolkit.x509Certificate.parser(d,"Base64"),b=a.usWebToolkit.x509Certificate.getSubjectName()}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during parsing certificate and getting subject name.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}var n=null;try{n=a.usWebToolkit.pki.certificateFromBase64(d)}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during decoding sign certificate base64 to binary.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}d=null;try{d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(g)}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during decoding sign private key base64 to binary.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}var k=g=null;if(l){try{g=a.usWebToolkit.pki.certificateFromBase64(l)}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during decoding km certificate base64 to binary.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}try{k=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(h)}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during decoding km private key base64 to binary.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}}try{m=a.usWebToolkit.pkcs12.makePKCS12(n,d,g,k,f,{useMac:!0,generateLocalKeyId:!0})}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during encoding pkcs#12.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}l=null;try{l=a.usWebToolkit.asn1.toDer(m).getBytes()}catch(r){throw b={},b.code=__err_code.ERROR_JSUSTOOLKIT,b.message="[LocalStorageHandler GetP12ForBuToPc Failed][TOOLKIT ERROR] during getting pkcs#12 binary.",b.detail="error code : "+r.code+"\nerror message : "+r.message,b;}m=Array(l.length);for(h=0;h<l.length;h++)m[h]=l.charCodeAt(h);var m=new Uint8Array(m);b=a.certUtil().getCN(b)+".p12";a.fileUtil().save(b,m)}a.uiUtil().loadingBox(!1,"us-div-list-load")})},onCancel:function(){pwdDialog.dispose();a.uiUtil().msgBox(c.IDS_MSGBOX_EXPORT_CLOUD_CERT_CANCEL)}});pwdDialog.show()},onCancel:function(){g.dispose();a.uiUtil().msgBox(c.IDS_MSGBOX_EXPORT_CLOUD_CERT_CANCEL)}});g.show()}function pa(c){a.CLOUD.getCertificateHistory(function(b){if(0!=b.resultCode)a.uiUtil().msgBox(b.resultMessage);else{var c=a.loadUI("cloudlist")({type:"CERT_HISTORY",args:b.certHistory,onConfirm:function(){c.dispose()},onCancel:function(){c.dispose()}});c.show()}})}function qa(c){a.CLOUD.checkConn(function(b){b?a.CLOUD.disConnect(function(b){0!=b.resultCode?a.uiUtil().msgBox(c.IDS_MSGBOX_CLOUD_DISCONNECT_ERROR+", Code"+b.resultCode):(a.uiUtil().msgBox(c.IDS_MSGBOX_CLOUD_DISCONNECT_SUCCESS),k.redrawList(null,-1))}):a.uiUtil().msgBox(c.IDS_MSGBOX_CLOUD_NOT_CONNECT)})}function ra(c){a.CLOUD.getAutoConnectInfo(function(b){if(0!=b.resultCode)a.uiUtil().msgBox(b.resultMessage);else if(b.autoConnectInfo){var d=a.loadUI("cloudlist")({type:"AUTO_CON",args:b.autoConnectInfo,onConfirm:function(b){d.dispose();a.CLOUD.deleteAutoConnect(b,function(b){0!=b.resultCode?a.uiUtil().msgBox(c.IDS_MSGBOX_CLOUD_DELETE_AUTOCON_ERROR+", Code"+b.resultCode):(a.uiUtil().msgBox(c.IDS_MSGBOX_CLOUD_DELETE_AUTOCON_SUCCESS),k.redrawList(null,-1))})},onCancel:function(){d.dispose()}});d.show()}})}function da(c,b){if(null==c||0>=c.length||null==b)return!1;if(0<c.length&&-1<c.indexOf(".")){if(c=c.split("."),c=c[c.length-1].toLowerCase(),"pfx"!=c&&"p12"!=c)return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_NOT_PFX),!1}else return a.uiUtil().msgBox(b.IDS_MSGBOX_FILE_ERROR_READ),!1;return!0}function ea(c,b,d){function g(b,c){a.nimservice().ExportCert(b,c,function(b,c,e){if(0==b&&e&&0<e.length)a.uiUtil().msgBox(f.IDS_MSGBOX_CERT_EXPORT_SUCCESS+"\n\n"+e),d&&d(0);else switch(b=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),b){case 4301E4:case 4302E4:case 4303E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;case 4013E4:a.uiUtil().msgBox(f.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_LOW_PERFORM_MEDIA);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_EXPORT_ERROR,b)}a.uiUtil().loadingBox(!1,"us-div-list-load")})}if(!c||!b)return!1;var f=b;if(!a.certsList)return a.uiUtil().msgBox(f.IDS_MSGBOX_COMMON_ERROR_NO_SELECTED_CERT),!1;var l=document.getElementById("us-cert-manage-put-cert-out-btn");if(4==a.ESVS.Mode||6==a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))if(a.nimservice()&&null!=a.nimservice()){var h=parseInt(k.selectedIndex());c=a.loadUI("password");Dialog=c({type:null,args:null,onConfirm:function(b){m!=a.CONST.__USFB_M_DISK.device&&m!=a.CONST.__USFB_M_SMARTCARD.device&&m!=a.CONST.__USFB_M_MOBILE.device&&m!=a.CONST.__USFB_M_HDD.device&&m!=a.CONST.__USFB_M_SECUREDISK.device&&m!=a.CONST.__USFB_M_ETC.device?(g(h,b),Dialog.dispose()):a.nimservice().CheckPassword(m,v,h,b,!0,function(c,d){0==c?g(h,b):(a.uiUtil().msgBox(""==d?f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD:d),a.uiUtil().loadingBox(!1,"us-div-list-load"));b="";Dialog.dispose();setTimeout(function(){l.focus()},10)})},onCancel:function(){Dialog.dispose();setTimeout(function(){l.focus()},10)}});Dialog.show()}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD);else m==a.CONST.__PF_M_SS.device?(c=a.loadUI("password"),Dialog=c({type:null,args:null,onConfirm:function(b){var c=parseInt(k.selectedIndex());if(!a.PFUC)return b="",!1;m==a.CONST.__PF_M_SS.device&&a.CCPFSH();try{var d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),e=a.usWebToolkit.pkcs8.checkUserCertPassword(d,b);d="";!1===e?a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().isItPortableDevice()?a.CCPFSH().GetP12ForBuToMo(c,"hex",function(b,c,d,f){0!=b?a.uiUtil().errMsgBox(c,b):a.uiUtil().ExportToBackupStore(f,d);Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)}):a.CCPFSH().GetP12ForBuToPc(c,b,"base64",function(b,c,d,f){if(0!=b)a.uiUtil().errMsgBox(c,b);else{b=a.usWebToolkit.util.decode64(f);c=Array(b.length);for(f=0;f<b.length;f++)c[f]=b.charCodeAt(f);b=new Uint8Array(c);d=a.certUtil().getCN(d)+".p12";a.fileUtil().save(d,b)}Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)})}catch(z){a.uiUtil().errMsgBox(z.message,z.code)}finally{}},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)}})):(c=a.loadUI("password"),Dialog=c({type:null,args:null,onConfirm:function(b){var c=parseInt(k.selectedIndex());if(!a.PFUC)return b="",!1;try{var d=a.usWebToolkit.pkcs8.encryptedPrivateKeyFromBase64(a.PFUC[c].signpri),e=a.usWebToolkit.pkcs8.checkUserCertPassword(d,b);d="";if(!1===e)a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);else if(a.uiUtil().isItPortableDevice()){var g=a.PFSH.GetP12ForBuToMo(c,"hex");a.uiUtil().ExportToBackupStore(g.p12,g.key);g=null}else{g=a.PFSH.GetP12ForBuToPc(c,b);var h=g.p12,n=g.dn,m=a.certUtil().getCN(n)+".p12";a.fileUtil().save(m,h);h=n=g=null}}catch(Z){a.uiUtil().errMsgBox(Z.message,Z.code)}finally{}b="";Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)},onCancel:function(){Dialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){l.focus()},10)}})),Dialog.show();return!0}function sa(c){if(!c)return!1;var b=a.loadUI("swinfo")({type:null,args:null,onConfirm:function(){b.dispose();setTimeout(function(){c.focus()},10)},onCancel:function(){b.dispose();setTimeout(function(){c.focus()},10)}});b.show();return!0}function N(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!1;a.disabled=!1}function V(){var a=document.getElementById("us-cert-manage-cert-copy-btn");a.readOnly=!0;a.disabled=!0}function J(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!1;a.disabled=!1}function X(){var a=document.getElementById("us-cert-manage-pw-change-btn");a.readOnly=!0;a.disabled=!0}function K(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!1;a.disabled=!1}function P(){var a=document.getElementById("us-cert-manage-put-cert-out-btn");a.readOnly=!0;a.disabled=!0}function O(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!1;a.disabled=!1}function fa(){var a=document.getElementById("us-cert-manage-cert-delete-btn");a.readOnly=!0;a.disabled=!0}function I(){var a=document.getElementById("us-cert-manage-get-cert-btn");a.readOnly=!1;a.disabled=!1}function F(c){c==a.CONST.__PF_M_LS.device?(V(),J(),a.uiUtil().isItSupportingPFCertBackUp()?K():P(),I()):c==a.CONST.__PF_M_SS.device?(V(),J(),a.uiUtil().isItSupportingPFCertBackUp()?K():P(),I()):c==a.CONST.__USFB_M_HDD.device?(N(),J(),K(),O(),I()):c==a.CONST.__USFB_M_DISK.device?(N(),J(),K(),O(),I()):c==a.CONST.__USFB_M_HSMKEY.device?(V(),X(),P(),O(),I()):c==a.CONST.__USFB_M_SMARTCARD.device?(N(),J(),K(),O(),I()):c==a.CONST.__USFB_M_MOBILE.device?(N(),X(),K(),fa()):c==a.CONST.__USFB_M_SECUREDISK.device?(N(),J(),P(),O(),I()):c==a.CONST.__PF_M_CLOUDSIGN.device?(V(),X(),P(),fa(),c=document.getElementById("us-cert-manage-get-cert-btn"),c.readOnly=!0,c.disabled=!0):(N(),J(),K(),O(),I())}function ta(c,b,d,g){if(a.CONST.__USFB_M_DISK.device>c||!b||!d||!g)return!1;var f=a.loadUI("driveselect")({type:"DEVICE_REMOVABLE_DISK",args:b,onConfirm:function(l){l=b.list[l-1].index;0<l&&x(c,l,g,"",function(b){0!=b?(a.uiUtil().errMsgBox(g.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b),k.redrawList(null,0)):(b=y())?k.redrawList(b.list,b.list.length):k.redrawList(null,0);h=!1;a.ESVS.Embedded?setTimeout(function(){f.focus()},10):f.dispose();d.focus();a.uiUtil().loadingBox(!1,"us-div-list-load")})},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");f.dispose();d.focus()}});f.show()}function ua(c,b,d,g){if(a.CONST.__USFB_M_DISK.device>c||!d||!g)return h=!1;var f=a.loadUI("sectokenselect")({type:c,args:b,onConfirm:function(b){0<b?(a.ESVS.Embedded?setTimeout(function(){f.dispose()},10):f.dispose(),x(c,b,g,"",function(b){if(0!=b){switch(b){case 4812E4:case 4813E4:a.uiUtil().msgBox(g.IDS_MSGBOX_HSM_ERROR_CONNECTION);break;default:a.uiUtil().errMsgBox(g.IDS_MSGBOX_COMMON_ERROR_GET_CERT,b)}k.redrawList(null,0)}else(b=y())?k.redrawList(b.list,b.list.length):k.redrawList(null,0);h=!1;d.focus()})):h=!1},onCancel:function(){h=!1;f.dispose();d.focus()}});f.show()}function va(c,b,d,g){if(a.CONST.__USFB_M_DISK.device>c||!b||!d||!g)return h=!1;a.uiUtil().loadingBox(!0,"us-div-list-load",0);var f=a.loadUI("driveselect")({type:"DEVICE_SAVE_TOKEN",args:b,onConfirm:function(b){f.dispose();a.nimservice()?a.nimservice().CheckSCardConnected(function(b,f){0===b?(PINDialog=a.loadUI("pin")({type:"PIN_SAVE_TOKEN",args:null,onConfirm:function(b){a.ESVS.Embedded?setTimeout(function(){PINDialog.dispose()},10):PINDialog.dispose();a.nimservice().CheckSCardPin(b,function(f,e){if(0!=f){switch(f){case 4904E4:a.uiUtil().msgBox(g.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(g.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;default:a.uiUtil().errMsgBox(g.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN,f)}k.redrawList(null,0);h=!1;setTimeout(function(){d.dispose()},10)}else x(c,1,g,b,function(a){0!=a?k.redrawList(null,0):(a=y())?k.redrawList(a.list,a.list.length):k.redrawList(null,0);h=!1;setTimeout(function(){d.dispose()},10)})})},onCancel:function(){h=!1;PINDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.dispose()},10)}}),PINDialog.show()):(h=!1,a.uiUtil().msgBox(g.IDS_MSGBOX_SMART_CARD_UNCONNECTED),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){d.dispose()},10))}):(h=!1,a.uiUtil().msgBox(g.IDS_MSGBOX_NIM_ERROR_UNLOAD),a.uiUtil().loadingBox(!1,"us-div-list-load"),setTimeout(function(){d.dispose()},10))},onCancel:function(){h=!1;f.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");setTimeout(function(){d.dispose()},10)}});f.show()}function wa(c,b){if(!c||!b)return h=!1;m=a.CONST.__PF_M_SS.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);x(a.CONST.__PF_M_SS.device,0,b,"",function(c){if(0!=c)return win&&"none"!=win.style.display&&a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0),h=!1;(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1})}function xa(c,b){if(!c||!b)return h=!1;m=a.CONST.__PF_M_LS.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);a.uiUtil().loadingBox(!0,"us-div-list-load",0);setTimeout(function(){x(a.CONST.__PF_M_LS.device,0,b,"",function(c){a.uiUtil().loadingBox(!1,"us-div-list-load",0);if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0),h=!1;(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1})},10);return!0}function ya(c,b){if(!c||!b)return h=!1;m=a.CONST.__PF_M_CLOUD.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);x(a.CONST.__PF_M_CLOUD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0),h=!1;(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1})}function za(c,b){if(!c||!b)return h=!1;m=a.CONST.__USFB_M_HDD.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);x(a.CONST.__USFB_M_HDD.device,0,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0),h=!1;(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1;return!0})}function Aa(c,b){if(!c||!b)return h=!1;h=!0;var d=null;m=a.CONST.__USFB_M_DISK.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))if(a.nimservice())a.nimservice().GetDiskList(function(g,f,l){f=0;l&&(f=l.length);if(0==g&&0<f){g=[];for(var k=0,e=0;k<f;k++)if("MacIntel"!=navigator.platform||"Macintosh HD"!=l[k]){var m={};m.index=k+1;m.name=l[k];g[e++]=m}d={list:g}}else return a.uiUtil().loadingBox(!1,"us-div-list-load"),a.certsList=null,h=!1;h=!1;ta(a.CONST.__USFB_M_DISK.device,d,c,b)});else return h=!1,a.uiUtil().loadingBox(!1,"us-div-list-load"),a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else h=!1;return!0}function Ba(c,b){if(!c||!b)return h=!1;h=!0;var d=null;m=a.CONST.__USFB_M_HSMKEY.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().GetHSMList(1,function(g,f,l){f=0;l&&(f=l.length);if(0==g&&0<f){g=0;for(var k=[],e=0;e<f;e++){var m=e+1,p={},u=l[e].split("|");p.index=m;p.name=u[0];p.driver=u[1];p.passage=u[2];p.validity=u[3];k[g++]=p}d={list:k}}else a.uiUtil().loadingBox(!1,"us-div-list-load"),a.nimservice().GetLastErrorCode();h=!1;ua(a.CONST.__USFB_M_HSMKEY.device,d,c,b)});else return h=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else h=!1;return!0}function Ca(c,b){if(!c||!b)return h=!1;h=!0;m=a.CONST.__USFB_M_SECUREDISK.device;v=1;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);a.nimservice().IsSDInstalled(function(c,g){a.uiUtil().loadingBox(!1,"us-div-list-load");0!=c?(a.ERROR.Code=31001,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SD,confirm(b.IDS_CONFIRMBOX_NOT_INSTALL_SD)&&(document.getElementById("us-cert-manage-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ESVS.SDInstallURL,"securedisk_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.ESVS.SDInstallURL,"securedisk_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW)),h=!1):x(a.CONST.__USFB_M_SECUREDISK.device,1,b,"",function(c){if(0!=c)return a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c),k.redrawList(null,0),h=!1;(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1;return!0})})}function Da(c,b){if(!c||!b)return h=!1;h=!0;m=a.CONST.__USFB_M_MOBILEOTKEN.device;v=0;a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode)if(a.nimservice())a.nimservice().IsInstalledUSIMModule(2,!1,function(c,g){a.uiUtil().loadingBox(!1,"us-div-list-load");0==c?(h=!0,a.nimservice().SetUSIMOptions(a.usimEnv.sitecode,a.usimEnv.modecode,a.usimEnv.siteURL,a.usimEnv.serviceIP,a.usimEnv.servicePort,a.usimEnv.downloadURL,function(a){document.getElementById("us-confirm-btn").click()})):(h=!0,4847E4==c||4117E4==c?(a.ERROR.Code=21002,a.ERROR.Message=b.IDS_MSGBOX_NOT_INSTALL_SMARTCERT,c=document.getElementById("us-cert-manage-cls-btn"),c.click(),null==("firefox"==a.browserName?window.open(a.usimEnv.downloadURL,"usim_url","scrollbars=1, op=100px, left=100px, height=500px, width=380px"):window.open(a.usimEnv.downloadURL,"usim_url","top=100px, left=100px, height=500px, width=380px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW)):(a.ERROR.Code=a.nimservice().GetLastErrorCode(),a.ERROR.Message=a.nimservice().GetLastErrorMessage(),a.uiUtil().errMsgBox(a.ERROR.Message,a.ERROR.Code),c=document.getElementById("us-cert-manage-cls-btn"),c.click()));h=!1});else return h=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else h=!1;return!0}function Ea(c,b){if(!c||!b)return h=!1;m=a.CONST.__USFB_M_MOBILE.device;v=0;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);if(4&a.ESVS.Mode&&!a.uiUtil().isItPFDevice(m))if(a.nimservice())x(m,v,b,"",function(c){if(0!=c){switch(c){case 61E6:case 6101E4:a.ERROR.Code=11003;confirm(b.IDS_MSGBOX_NOT_INSTALL_MOBILE_CFM)&&(h=!1,document.getElementById("us-cert-manage-cls-btn").click(),null==("firefox"==a.browserName?window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","scrollbars=1, op=100px, left=100px, height=500px, width=500px"):window.open(a.ubiKeyEnv.downloadURL,"ubikey_url","top=100px, left=100px, height=500px, width=500px"))&&a.uiUtil().msgBox(b.IDS_MSGBOX_BLOCK_POPUP_WINDOW));break;case 6102E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_LOAD_LIBRARY,c);break;case 6107E4:a.uiUtil().errMsgBox(b.IDS_MSGBOX_UBIKEY_SET_ENV,c)}k.redrawList(null,0)}else(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1});else return h=!1,a.uiUtil().msgBox(b.IDS_MSGBOX_NIM_ERROR_UNLOAD),!1;else h=!1;return!0}function Q(c,b){if(!c||!b)return h=!1;h=!0;a.uiUtil().MsgBox(b.IDS_MSGBOX_NOT_SUPPORTED_MEDIA);return!0}function C(c){var b="browsersign";if(c==a.CONST.__PF_M_LS.device||c==a.CONST.__PF_M_SS.device)b="browsersign";else if(c==a.CONST.__PF_M_CLOUDSIGN.device)b="cloudsign";else{null!=H&&(H.dispose(),H=null);return}null!=H?H.changeMedia(b):setTimeout(function(){H=a.loadUI("guide")({type:b,onCancel:function(){H.dispose();H=null}});H.show()},10)}function Fa(c,b){if(!c||!b)return!1;F(m);ha=a.loadUI("gridlist");k=ha({type:"certslist",tblid:"us-cert-manage-tbl-list",tbltitleid:"us-cert-manage-tbl-list-th",titlelistid:"us-cert-manage-grid-head-div",titlerowid:"us-cert-manage-list-title-row",titleelementid:"us-cert-manage-list-title-element",titledividerid:"us-cert-manage-list-title-divider",titlelistcn:"us-layout-grid-head-div",titlerowcn:"us-layout-grid-head-row",titleelementcn:"us-layout-grid-row-title-element",titledividercn:"us-layout-grid-row-title-divider",tblbodyid:"us-cert-manage-tbl-list-td",datalistid:"us-cert-manage-grid-body-div",datarowid:"us-cert-manage-list-body-row",dataelementid:"us-cert-manage-list-data-element",datalistcn:"us-layout-grid-body-div",datarowcn:"us-layout-grid-body-row",dataelementcn:"us-layout-grid-row-data-element",dataselectcn:"us-layout-grid-row-data-selected-element",textObj:b});var d=!0;"opera"==a.browserName&&(d=!1);k.drawList(c,c.length,null,0,ia,d);for(var g in a.CONST)if(a.CONST[g].device==m&&1==a.CONST[g].disabled)return;x(m,v,b,"",function(c){0!=c?a.uiUtil().errMsgBox(b.IDS_MSGBOX_COMMON_ERROR_GET_CERT,c):(c=y())?k.redrawList(c.list,c.list.length):k.redrawList(null,0);h=!1})}function G(c){if(!c)return!1;R(c,q,"close");for(var b=a.ESVS.Media.list.split("|"),d=0;d<b.length;d++){var g=a.CONST.medias[b[d]];void 0!=g&&null!=g&&(g=document.getElementById("us-cert-manage-btn-"+g.name),void 0!=g&&null!=g&&"us-layout-storage-btn-none"!=g.className&&(c===g?(g.className="us-layout-storage-btn-on",g.setAttribute("title",q.IDS_STORAGE_SELECTED)):(g.className="us-layout-storage-btn-off",g.setAttribute("title",""))))}return!0}function Ga(c){if(null==c||void 0==c)return!1;var b=!a.uiUtil().isItSupportingThisStorage(c);0==b&&null!=a.ESVS.Media&&null!=a.ESVS.Media.list&&0>a.ESVS.Media.list.indexOf(c.name)&&(b=!0);if(b)return!1;b=document.getElementById("us-cert-manage-storage-btn-list");var d=document.createElement("li");d.setAttribute("id","us-cert-manage-storage-btn-li-"+c.name,0);d.setAttribute("mediaIndex",c.mediaIndex,0);7==c.mediaIndex&&(d.className="line-first");"hidden"===c.visibility?(d.style.display="none",d.style.visibility="hidden"):(d.style.display="block",d.style.visibility="visible");var g=document.createElement("button");g.setAttribute("type","button",0);g.setAttribute("id","us-cert-manage-btn-"+c.name,0);g.setAttribute("title",c.label,0);g.setAttribute("tabindex",c.tabIndex,0);c.disabled?(g.onclick=function(){a.uiUtil().msgBox(q.IDS_MSGBOX_NOT_SUPPORTED_MEDIA)},g.className="us-layout-storage-btn-none"):(g.onclick=c.onclick,c.device===m?(g.className="us-layout-storage-btn-on",g.setAttribute("title",q.IDS_STORAGE_SELECTED)):(g.className="us-layout-storage-btn-off",g.setAttribute("title","")));d.appendChild(g);if(!a.ESVS.chkEXESetup&&"cloudsign"!==c.name&&"webstorage"!==c.name&&"browsersign"!==c.name&&"qrcode"!==c.name){var f=document.createElement("span");f.className="us-download-select";g.appendChild(f)}f=document.createElement("span");f.className="us-img-storage";var h=document.createElement("img");h.setAttribute("id","us-cert-manage-img-"+c.name,0);h.setAttribute("alt",c.label,0);"browsersign"==c.name?"unknown"==a.browserName?c.disabled?h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0):c.disabled?h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/browser/"+a.browserName+"_d.png",0):h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/browser/"+a.browserName+".png",0):c.disabled?h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+"_d.png",0):h.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_"+c.name+".png",0);f.appendChild(h);g.appendChild(f);f=document.createElement("span");f.setAttribute("id","us-cert-manage-lbl-"+c.name,0);f.className="us-layout-lbl-storage";f.appendChild(document.createTextNode(c.label));g.appendChild(f);d.appendChild(g);b.appendChild(d);return!0}function R(c,b,d){if("no_more"==d)a.uiUtil().msgBox(b.IDS_MSGBOX_NOT_MORE_MEDIA);else{document.getElementById("us-cert-manage-storage-wrap");"open"==d?(c=document.getElementById("us-cert-manage-div-storage"),c.style.height="186px",c=document.getElementById("us-cert-manage-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN+b.IDS_BUTTON,0),c.onclick=function(){R(this,b,"close")},c=document.getElementById("us-cert-manage-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_HIDDEN,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_close.png",0)):(c=document.getElementById("us-cert-manage-div-storage"),c.style.height="96px",c=document.getElementById("us-cert-manage-storage-more-btn"),c.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),c.onclick=function(){R(this,b,"open")},c=document.getElementById("us-cert-manage-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));c=a.ESVS.Media.list.split("|");for(var g=0;g<c.length;g++){var f=a.CONST.medias[c[g]];if(void 0!=f&&null!=f){var h=document.getElementById("us-cert-manage-storage-btn-li-"+f.name);if(void 0!=h&&null!=h){var k=h.getAttribute("mediaIndex");"open"==d?(h.style.display="block",h.style.visibility="visible"):6<k?(h.style.display="none",h.style.visibility="hidden"):(h.style.display="block",h.style.visibility="visible");1==k&&document.getElementById("us-cert-manage-btn-"+f.name)}}}}return!0}function L(){k.restoreOnMouseEvent();m==a.CONST.__PF_M_CLOUDSIGN.device&&a.PFCS().reqCloseSession();a.ESVS._chkEXESetupCancel=!0;if(1<=arguments.length)p.onConfirm(arguments[0],arguments[1]);else p.onCancel()}function B(a){try{var b=document.querySelector(".us-layout-storage-btn-on span img").alt,c=document.querySelector(".us-layout-storage-btn-on span img").src,g=document.getElementById("us-cert-manage-img-current-storage");g.setAttribute("alt",b,0);g.setAttribute("src",c,0);g=document.getElementById("us-cert-manage-lbl-current-storage");g.innerHTML=b;k&&0>k.selectedIndex()&&(document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+a.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML="")}catch(f){Ha.log("getCurrDevice error")}}function Ia(a,b,d){switch(p.args.type){case 1:aa(a,b,d);break;case 2:ba(a,b,d);break;case 3:S(b,d);break;case 4:ea(a,b,d);break;case 5:ca(a,b,d);break;case 6:la(a,b,d);break;case 7:U(a,b)}}var Ja=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/layout/certmanage.html?version="+a.ver,!1);c.send(null);return c.responseText},ja=function(){var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0");c.open("GET",a.ESVS.SRCPath+"unisignweb/rsrc/lang/"+a.ESVS.Language+"/certmanage_"+a.ESVS.Language+".js?version="+a.ver,!1);c.send(null);return c.responseText},q=a.CustomEval(ja,!0),ha=null,k=null,w=a.ESVS.TabIndex+1,ia=0,m=a.CONST.__USFB_M_HDD.device,v=0,h=!1,H=null;if(null!=a.ESVS.Media&&null!=a.ESVS.Media.defaultdevice){m=a.uiUtil().getMediaDevice(a.ESVS.Media.defaultdevice);a.uiUtil().isItPFDevice(m)&&4==a.ESVS.Mode&&(a.SELECTINFO.curdevice=m=a.CONST.__USFB_M_HDD.device);if(m==a.CONST.__USFB_M_SECUREDISK.device||m==a.CONST.__USFB_M_SMARTCARD.device)v=1;a.SELECTINFO.curdevice=m}else 2==a.ESVS.Mode&&(m=a.CONST.__PF_M_LS.device,a.SELECTINFO.curdevice=m);!p.args||6!=p.args.type&&7!=p.args.type||(m=a.CONST.__USFB_M_SECUREDISK.device,v=1,a.SELECTINFO.curdevice=m);var Ha=window.console||{log:function(){}},S=null,W=null;window.FileReader?(S=function(c,b){if(null==c)return!1;a.uiUtil().loadingBox(!0,"us-div-list-load");if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{var d=a.loadUI("importcert")({type:"importcert",args:null,onConfirm:function(b,c){var f=document.getElementById("us-cert-manage-get-cert-btn");"MPKI"==a.ESVS.PKI?(W(a.CONST.__USFB_M_HDD.device,0,b,c),setTimeout(function(){f.focus()},10)):m==a.CONST.__PF_M_CLOUD.device?(a.uiUtil().loadingBox(!1,"us-div-list-load"),d.dispose(),W(a.CONST.__PF_M_CLOUD.device,0,b,c),setTimeout(function(){f.focus()},10)):(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:{possibleWhale:!1},onConfirm:function(g,e){SSDialog.dispose();a.uiUtil().loadingBox(!1,"us-div-list-load");d.dispose();W(g,e,b,c);setTimeout(function(){f.focus()},10)},onCancel:function(){pw="";SSDialog.dispose();setTimeout(function(){f.focus()},10)}}),SSDialog.show())},onCancel:function(){a.uiUtil().loadingBox(!1,"us-div-list-load");a.uiUtil().msgBox(c.IDS_MSGBOX_CERT_IMPORT_CANCEL);d.dispose();var b=document.getElementById("us-cert-manage-get-cert-btn");setTimeout(function(){b.focus()},10)}});d.show()}return!0},W=function(c,b,d,g){function f(){var a=y();a?k.redrawList(a.list,a.list.length):k.redrawList(null,0)}function l(b,c,d,f){0===b&&(a.uiUtil().msgBox(q.IDS_MSGBOX_CERT_IMPORT_SUCCESS),m===c&&v===d&&(a.CONST.__USFB_M_SMARTCARD.device===m&&0===v&&x(m,v,q,f,function(a){(a=y())?k.redrawList(a.list,a.list.length):k.redrawList(null,0);h=!1}),x(m,v,q,"",function(a){(a=y())?k.redrawList(a.list,a.list.length):k.redrawList(null,0);h=!1})))}var n=g;document.getElementById("us-cert-get-btn");if(c==a.CONST.__PF_M_CLOUD.device){var e=a.loadUI("newpin"),w=e({args:null,onConfirm:function(f){w.dispose();var e=a.usWebToolkit.util.decode64(d);e=a.usWebToolkit.asn1.fromDer(e);e=a.usWebToolkit.pkcs12.getCertNKeyFromPKCS12(e,n).getCertAndKeyFromPKCS12(n);var g={};try{!e.sign.cert&&e.km.cert?(g.signcert=a.usWebToolkit.pki.certificateToBase64(e.km.cert),g.signpri=a.usWebToolkit.pkcs8.encryptedPrivateKeyToBase64(e.km.prikey)):(g.signcert=a.usWebToolkit.pki.certificateToBase64(e.sign.cert),g.signpri=a.usWebToolkit.pkcs8.encryptedPrivateKeyToBase64(e.sign.prikey)),"undefined"!==typeof e.km?(g.kmcert=a.usWebToolkit.pki.certificateToBase64(e.km.cert),g.kmpri=a.usWebToolkit.pkcs8.encryptedPrivateKeyToBase64(e.km.prikey)):(g.kmcert="",g.kmpri=""),a.uiUtil().loadingBox(!0,"us-div-list-load",a.uiUtil().getErrorMessageLang().IDS_CLOUD_UPLOAD),a.CLOUD.uploadCert(g,n,f,function(d){l(d.resultCode,c,b,"");a.uiUtil().loadingBox(!1,"us-div-list-load")})}catch(ka){a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,ka.code)}},onCancel:function(){w.dispose()}});w.show()}else if(c==a.CONST.__PF_M_LS.device){e=0;try{a.PFSH.LoadAllCerts(document.domain)}catch(r){301E5===r.code&&(a.PFSH.InstallCACerts(document.domain),a.PFSH.LoadAllCerts(document.domain))}try{var t=a.PFSH.SetP12OnMemory(d,n),u=t.aluc[t.index];a.usWebToolkit.x509Certificate.parser(u.signcert,"Base64");var z=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),M=a.certUtil().getIssuerEnName(z);a.PFSH.SaveUserCert(M,u,document.domain,!0)}catch(r){switch(e=r.code,r.code){case 1E7:0<=r.detail.indexOf("115010")?a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,r.code);break;default:a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,r.code)}}l(e,c,b,"")}else if(c==a.CONST.__PF_M_SS.device){var A=function(d,f){a.CCPFSH().SetP12OnMemory(d,f,function(d,e,g){if(0==d)d=g.aluc[g.index],a.usWebToolkit.x509Certificate.parser(d.signcert,"Base64"),e=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),e=a.certUtil().getIssuerEnName(e),a.CCPFSH().SaveUserCert(e,d,!0,function(d){f="";0==d?l(d,c,b,""):a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,d)});else{switch(d){case 1E7:0<=e.indexOf("115010")?a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,d);break;default:a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}f=""}})};a.CCPFSH().IsCCPFSHAvailable(function(b){0==b?A(d,n):a.CCPFSH().GetCCStorageHandler(a.ESVS.EncAlgo,a.ESVS.HashAlgo,a.ESVS.BSPKI,function(a,b){0==a&&A(d,n)})})}else a.CONST.__USFB_M_HSMKEY.device===c||a.CONST.__USFB_M_SMARTCARD.device===c?(t=null,t=a.CONST.__USFB_M_SMARTCARD.device===c?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",e=a.loadUI("pin"),w=e({type:t,args:null,onConfirm:function(e){a.nimservice().ImportCert(0,d,g,c,b,e,function(d,g){if(0==d)p.args&&3==p.args.type&&L(),m==c&&v==b&&c!=a.CONST.__USFB_M_MOBILE.device?l(d,c,b,e):(f(),a.uiUtil().msgBox(q.IDS_MSGBOX_CERT_IMPORT_SUCCESS));else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),d){case 4823E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(q.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(q.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:g=a.nimservice().GetLastErrorMessage();g=q.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+g;a.uiUtil().msgBox(g);break;case 4019E4:a.uiUtil().errMsgBox(g,d);break;case 4301E4:0<=g.indexOf("3509")?a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,d);break;default:switch(d=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),d){case 3509:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(g?g:q.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}}});w.dispose()},onCancel:function(){n="";w.dispose()}}),w.show()):a.nimservice().ImportCert(0,d,g,c,b,"",function(d,e){if(0==d)m==c&&v==b&&c!=a.CONST.__USFB_M_MOBILE.device?l(d,c,b,""):(f(),a.uiUtil().msgBox(q.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),p.args&&3==p.args.type&&L();else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),d){case 4823E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(q.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(q.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:e=a.nimservice().GetLastErrorMessage();e=q.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+e;a.uiUtil().msgBox(e);break;case 4019E4:a.uiUtil().errMsgBox(e,d);break;case 4301E4:0<=e.indexOf("3509")?a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD):a.uiUtil().errMsgBox(q.IDS_MSGBOX_CERT_IMPORT_ERROR,d);break;default:switch(d=a.nimservice().GetLastErrorCode(),a.nimservice().GetLastErrorMessage(),d){case 3509:a.uiUtil().msgBox(q.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(e?e:q.IDS_MSGBOX_CERT_IMPORT_ERROR,d)}}})}):(S=function(c,b){if(null==c)return!1;if(a.uiUtil().isItPortableDevice())a.uiUtil().ImportFromBackupStore();else{b=document.getElementById("us-cert-manage-file-search-hidden");if("safari"==a.browserName&&6>parseFloat(a.browserVersion))return a.uiUtil().msgBox(c.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_SAFARI),!1;if("opera"==a.browserName||"safari"==a.browserName||"msie"==a.browserName&&8===parseInt(a.browserVersion))b.style.display="block";"safari"==a.browserName&&b.setAttribute("accept","",0);b.value="";if(""!=b.value){c=b.onchange;var d=b.parentNode;d.removeChild(b);b=document.createElement("input");b.setAttribute("type","file",0);"safari"==a.browserName?b.setAttribute("accept","",0):b.setAttribute("accept","application/x-pkcs12",0);b.setAttribute("id","us-cert-manage-file-search-hidden",0);b.className="us-layout-cert-manage-file-search-hidden";b.onchange=c;d.appendChild(b)}b.click()}return!0},ImportPFX=function(c,b){function d(b,c,d,e){a.uiUtil().msgBox(f.IDS_MSGBOX_CERT_IMPORT_SUCCESS);a.CONST.__USFB_M_SMARTCARD.device===m&&1===v?x(m,v,f,e,function(a){(a=y())?k.redrawList(a.list,a.list.length):k.redrawList(null,0);h=!1}):x(m,v,f,"",function(a){(a=y())?k.redrawList(a.list,a.list.length):k.redrawList(null,0);h=!1})}function g(b,c,e,g,h){function z(e){var h=0,z=n;null!=l&&(h=1,z=l);a.nimservice().ImportCert(h,z,g,b,c,e,function(h,l){if(0==h)m==b&&v==c&&b!=a.CONST.__USFB_M_MOBILE.device?d(h,b,c,e):((h=y())?k.redrawList(h.list,h.list.length):k.redrawList(null,0),a.uiUtil().msgBox(f.IDS_MSGBOX_CERT_IMPORT_SUCCESS)),p.args&&3==p.args.type&&L(),g=e="";else switch(a.uiUtil().loadingBox(!1,"us-div-list-load"),h){case 4823E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SEC_TOKEN_PIN);break;case 4825E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_SEC_TOKEN_PIN_LOCKED);break;case 4844E4:a.uiUtil().msgBox(f.IDS_MSGBOX_HSM_ERROR_MEMORY_TOO_SMALL);break;case 4846E4:a.uiUtil().msgBox(f.IDS_MSGBOX_HSM_ERROR_UNSUPPORT_KEY_LENGTH);break;case 4904E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_SAVE_TOKEN_PIN);break;case 4905E4:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_SAVE_TOKEN_PIN_LOCKED);break;case 4843E4:case 4123E4:h=a.nimservice().GetLastErrorMessage();h=f.IDS_MSGBOX_CERT_COPY_ERROR_NEWEST_CERT+"\n\n"+h;a.uiUtil().msgBox(h);break;case 4019E4:a.uiUtil().errMsgBox(l,h);break;default:switch(h=a.CONST.__PF_M_LS.device===b?h:a.nimservice().GetLastErrorCode(),h){case 3509:a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_INPUT_WRONG_PASSWORD);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_IMPORT_ERROR,h)}}})}var q=document.getElementById("us-cert-manage-get-cert-btn");if(4<=a.ESVS.Mode)if(a.CONST.__PF_M_LS.device==b||a.CONST.__PF_M_SS.device==b){if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;e=0;try{var u=a.PFSH.SetP12OnMemory(n,g),r=u.index,t=u.aluc[r];a.usWebToolkit.x509Certificate.parser(t.signcert,"Base64");var w=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),x=a.certUtil().getIssuerEnName(w);a.PFSH.SaveUserCert(x,t,document.domain,!0)}catch(D){switch(e=D.code,D.code){case 1E7:0<=D.detail.indexOf("115010")?a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_IMPORT_ERROR,D.code);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_IMPORT_ERROR,D.code)}}0==e&&d(e,b,c,"");g="";h&&h.dispose();setTimeout(function(){q.focus()},10)}else a.nimservice()?a.CONST.__USFB_M_HSMKEY.device===b||a.CONST.__USFB_M_SMARTCARD.device===b?(h&&h.dispose(),h=null,h=a.CONST.__USFB_M_SMARTCARD.device===b?"PIN_SAVE_TOKEN":"PIN_SECURITY_TOKEN",PINDialog=a.loadUI("pin")({type:h,args:null,onConfirm:function(a){z(a);PINDialog.dispose();setTimeout(function(){q.focus()},10)},onCancel:function(){g="";PINDialog.dispose();setTimeout(function(){q.focus()},10)}}),PINDialog.show()):(h&&h.dispose(),z("")):a.uiUtil().msgBox(f.IDS_MSGBOX_NIM_ERROR_UNLOAD);else{if(!a.PFSH)return a.uiUtil().msgBox("unsupport html5 storage"),!1;e=0;try{u=a.PFSH.SetP12OnMemory(n,g),r=u.index,t=u.aluc[r],a.usWebToolkit.x509Certificate.parser(t.signcert,"Base64"),w=a.usWebToolkit.x509Certificate.getCertificatePoliciesOid(),x=a.certUtil().getIssuerEnName(w),a.PFSH.SaveUserCert(x,t,document.domain,!0)}catch(D){switch(e=D.code,D.code){case 1E7:0<=D.detail.indexOf("115010")?a.uiUtil().msgBox(f.IDS_MSGBOX_PW_ERROR_PASSWORD_IS_NOT_MATCHED):a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_IMPORT_ERROR,D.code);break;default:a.uiUtil().errMsgBox(f.IDS_MSGBOX_CERT_IMPORT_ERROR,D.code)}}0==e&&d(e,b,c,"");g="";h&&h.dispose();setTimeout(function(){q.focus()},10)}}if(!c||!b)return!1;var f=b,l=null,n=null,e=document.getElementById("us-cert-manage-get-cert-btn");if("opera"==a.browserName||"safari"==a.browserName)c.style.display="none";if(window.FileReader)if(c=c.files,0<c.length){var q=c[0];if(1==da(q.name,f)){var t=new FileReader;t.readAsBinaryString?(t.readAsBinaryString(q),t.addEventListener("load",function(){var b=t.result,c=b.length;if(q.size===c)n=a.usWebToolkit.util.encode64(b,c);else return a.uiUtil().msgBox(f.IDS_MSGBOX_FILE_ERROR_READ),!1})):(t.readAsArrayBuffer(q),t.addEventListener("load",function(){var b=t.result,c=null;try{var d=String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(b)));try{c=decodeURIComponent(escape(d))}catch(r){var e=r;if("URIError"==e.name)c=d;else throw e;}}catch(r){return a.uiUtil().msgBox(f.IDS_MSGBOX_FILE_ERROR_READ),!1}b=c.length;if(q.size===b)n=a.usWebToolkit.util.encode64(c,b);else return a.uiUtil().msgBox(f.IDS_MSGBOX_FILE_ERROR_READ),!1}))}else return setTimeout(function(){e.focus()},10),!1}else return setTimeout(function(){e.focus()},10),!1;else{if("msie"==a.browserName&&8===parseInt(a.browserVersion))b=document.getElementById("us-div-cert-manage"),b.onselectstart=function(){return!0},c.select(),l=c.value,c.style.display="none",b.onselectstart=function(){return!1};else if("msie"==a.browserName&&9===parseInt(a.browserVersion)){if(l=c.value,-1<l.indexOf("fakepath"))return a.uiUtil().msgBox(f.IDS_MSGBOX_SEARCH_CERT_GUIDE_FOR_IE9),setTimeout(function(){e.focus()},10),!1}else l=c.value;if(0==da(l,f))return setTimeout(function(){e.focus()},10),!1}Dialog=a.loadUI("password")({type:null,args:null,onConfirm:function(b){Dialog.dispose();"MPKI"==a.ESVS.PKI?g(a.CONST.__USFB_M_HDD.device,0,l,b,null):(SSDialog=a.loadUI("storageselect")({type:"CERT_IMPORT",args:{possibleWhale:!1},onConfirm:function(a,c){g(a,c,l,b,SSDialog)},onCancel:function(){b="";SSDialog.dispose();setTimeout(function(){e.focus()},10)}}),SSDialog.show())},onCancel:function(){Dialog.dispose();setTimeout(function(){e.focus()},10)}});Dialog.show();return!0});return function(){var c=a.CustomEval(Ja),b=a.CustomEval(ja,!0);if(p.args&&p.args.style&&"child"==p.args.style){var d=document.createElement("div");document.body.insertBefore(d,document.body.firstChild);d.innerHTML=c()}else a.ESVS.TargetObj.innerHTML=c();document.getElementById("us-cert-manage-lbl-title").appendChild(document.createTextNode(b.IDS_CERT_MANAGEMENT));var g=document.getElementById("us-cert-manage-cls-img-btn");g.setAttribute("title",b.IDS_CLOSE_CERT_MANAGEMENT_CLOSE,0);g.onclick=function(){h&&a.ESVS.chkEXESetup||L()};c=document.getElementById("us-cert-manage-cls-btn-img");c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/cert_close_btn.png",0);c.setAttribute("alt",b.IDS_CLOSE_CERT_MANAGEMENT_CLOSE,0);c.setAttribute("tabindex",w++,0);document.getElementById("us-cursor-disabled").setAttribute("title",b.IDS_SENSE_READER_INTRO,0);c=document.getElementById("us-cert-manage-logo-img");c.setAttribute("alt",b.IDS_LOGO,0);c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/main_cert_logo.png",0);document.getElementById("us-cert-manage-legend-storage").appendChild(document.createTextNode(b.IDS_STORAGE_SELECT));c=0;d=a.ESVS.Media.list.split("|");for(var f=null,l=0;l<d.length;l++){var n=d[l],e=a.CONST.medias[n];if(void 0!=e&&null!=e){switch(e.device){case a.CONST.__USFB_M_DISK.device:e.label=b.IDS_STORAGE_REMOVABLE;e.disabled=2==a.ESVS.Mode||p.args&&(6==p.args.type||7==p.args.type)||"MPKI"==a.ESVS.PKI;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_DISK.device),a.ESVS._chkEXESetupCancel=!1,Aa(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__USFB_M_DISK.device)};break;case a.CONST.__USFB_M_HSMKEY.device:e.label=b.IDS_STORAGE_SECTOKEN;e.disabled=!p.args||1!=p.args.type&&2!=p.args.type&&4!=p.args.type&&6!=p.args.type&&7!=p.args.type?"win"!=a.osName||"MPKI"==a.ESVS.PKI:!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_HSMKEY.device),a.ESVS._chkEXESetupCancel=!1,Ba(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__USFB_M_HSMKEY.device)};break;case a.CONST.__USFB_M_SMARTCARD.device:e.label=b.IDS_STORAGE_SAVETOKEN;e.disabled="win"!=a.osName||p.args&&(6==p.args.type||7==p.args.type)||"MPKI"==a.ESVS.PKI;e.onclick=function(){if(!h||!a.ESVS.chkEXESetup){C(a.CONST.__USFB_M_SMARTCARD.device);a.ESVS._chkEXESetupCancel=!1;if(this&&b){h=!0;m=a.CONST.__USFB_M_SMARTCARD.device;v=1;F(m);a.certsList&&(a.certsList=null);k.redrawList(null,-1);var c=[],d={};d.index=a.CONST.__USFB_M_SMARTCARD.device;d.name=b.IDS_SAVETOKEN_SMART_CARD;c[0]=d;va(a.CONST.__USFB_M_SMARTCARD.device,{list:c},this,b)}else h=!1;G(this);B(b);a.SELECTINFO.curdevice=a.CONST.__USFB_M_SMARTCARD.device}};break;case a.CONST.__USFB_M_MOBILE.device:e.label=b.IDS_STORAGE_MOBILEPHONE;e.disabled=!p.args||2!=p.args.type&&5!=p.args.type&&6!=p.args.type&&7!=p.args.type?"win"!=a.osName||2==a.ESVS.Mode||"MPKI"==a.ESVS.PKI:!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_MOBILE.device),a.ESVS._chkEXESetupCancel=!1,Ea(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILE.device)};break;case a.CONST.__USFB_M_HDD.device:e.label=b.IDS_STORAGE_HARDDISK;e.disabled=2==a.ESVS.Mode||p.args&&(6==p.args.type||7==p.args.type);e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_HDD.device),a.ESVS._chkEXESetupCancel=!1,za(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__USFB_M_HDD.device)};break;case a.CONST.__USFB_M_MOBILETOKEN.device:e.label=b.IDS_STORAGE_MOBILETOKEN;e.disabled=!0;e.readOnly=!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_MOBILETOKEN.device),a.ESVS._chkEXESetupCancel=!1,document.getElementById("us-div-cert-manage").style.display="none",Da(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__USFB_M_MOBILETOKEN.device)};break;case a.CONST.__USFB_M_SECUREDISK.device:e.label=b.IDS_STORAGE_SECUREDISK;e.disabled=!p.args||1!=p.args.type&&4!=p.args.type?"win"!=a.osName||"MPKI"==a.ESVS.PKI:!0;e.readOnly=!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__USFB_M_SECUREDISK.device),a.ESVS._chkEXESetupCancel=!1,Ca(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__USFB_M_SECUREDISK.device)};break;case a.CONST.__PF_M_SS.device:e.label=b.IDS_STORAGE_SS;e.disabled=p.args&&1==p.args.type?!0:4==a.ESVS.Mode;if(1==e.disabled)break;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_SS.device),a.ESVS._chkEXESetupCancel=!0,wa(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_SS.device)};break;case a.CONST.__PF_M_LS.device:e.label=b.IDS_STORAGE_LS;e.disabled=p.args&&1==p.args.type?!0:4==a.ESVS.Mode;if(1==e.disabled)break;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_LS.device),a.ESVS._chkEXESetupCancel=!0,xa(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_LS.device)};break;case a.CONST.__PF_M_TOUCHSIGN.device:e.label=b.IDS_STORAGE_TOUCHSIGN;e.disabled=!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_TOUCHSIGN.device),a.ESVS._chkEXESetupCancel=!1,Q(this,b),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_TOUCHSIGN.device)};break;case a.CONST.__PF_M_SMARTSIGN.device:e.label=b.IDS_STORAGE_SMARTSIGN;e.disabled=!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_SMARTSIGN.device),a.ESVS._chkEXESetupCancel=!1,Q(this,b),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_SMARTSIGN.device)};break;case a.CONST.__PF_M_WEBSECTOKEN.device:e.label=b.IDS_STORAGE_WEBSECTOKEN;e.disabled=!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_WEBSECTOKEN.device),a.ESVS._chkEXESetupCancel=!1,Q(this,b),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSECTOKEN.device)};break;case a.CONST.__PF_M_WEBSOFTTOKEN.device:e.label=b.IDS_STORAGE_WEBSOFTTOKEN;e.disabled=!0;e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(a.CONST.__PF_M_WEBSOFTTOKEN.device),a.ESVS._chkEXESetupCancel=!1,Q(this,b),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_WEBSOFTTOKEN.device)};break;case a.CONST.__PF_M_CLOUDSIGN.device:e.label=b.IDS_STORAGE_CLOUDSIGN;e.disabled=!0;break;case a.CONST.__PF_M_CLOUD.device:e.label=b.IDS_STORAGE_CLOUD;e.disabled=4==a.ESVS.Mode||p.args;e.onclick=function(){h&&a.ESVS.chkEXESetup||(a.ESVS._chkEXESetupCancel=!0,ya(this,b),G(this),B(b),a.SELECTINFO.curdevice=a.CONST.__PF_M_CLOUD.device)};break;default:e.label=b.IDS_STORAGE_ETC,e.disabled=!0,e.onclick=function(){h&&a.ESVS.chkEXESetup||(C(0),a.ESVS._chkEXESetupCancel=!1,Q(this,b),B(b),a.SELECTINFO.curdevice=0)}}a.ESVS.Media.option&&0>=a.ESVS.Media.option&&-1*a.ESVS.Media.option&Math.pow(2,l)&&a.ESVS.Media.defaultdevice!=n&&(e.disabled=!0);e.tabIndex=w;e.mediaIndex=c+1;e.visibility=6<e.mediaIndex?"hidden":"visible";Ga(e)&&(w++,c++);null==f&&(f=e)}}d=document.getElementById("us-cert-manage-storage-more-btn");null!=d&&void 0!=d&&(d.setAttribute("title",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW+b.IDS_BUTTON,0),6<c?(d.style.display="block",d.style.visibility="visible",d.setAttribute("tabindex",w++,0),d.onclick=function(){R(this,b,"open")}):(d.setAttribute("disabled","disabled",0),d.style.display="none",d.style.visibility="hidden",d.onclick=function(){R(this,b,"no_more")}),c=document.getElementById("us-cert-manage-storage-more-btn-img"),c.setAttribute("alt",b.IDS_STORAGE_MORE_VIEW+b.IDS_STORAGE_MORE_VIEW_SHOW,0),c.setAttribute("src",a.ESVS.SRCPath+"unisignweb/rsrc/img/media_more_btn_open.png",0));document.getElementById("us-h5-storage").innerText=b.IDS_H5_STORAGE;document.getElementById("us-h5-list").innerText=b.IDS_H5_LIST;document.getElementById("us-cert-manage-tbl-list").style.summary=b.IDS_CERT_LIST_TABLE_SUMMARY;document.getElementById("us-cert-manage-tbl-list-caption").appendChild(document.createTextNode(b.IDS_CERT_LIST_CAPTION));a.ESVS.Mode&2&&a.uiUtil().loadingBox(!0,"us-div-list-load",0);var q=[{title:b.IDS_CERT_STATUS},{title:b.IDS_CERT_CLASSIFY},{title:b.IDS_CERT_USER},{title:b.IDS_CERT_ISSUER},{title:b.IDS_CERT_EXPIRATION_DAY}];ia=w++;setTimeout(function(){Fa(q,b)},100);window.FileReader||(document.getElementById("us-cert-manage-file-search-hidden").onchange=function(){ImportPFX(this,b)});null!=p.args&&null!=p.args.type?(document.getElementById("us-div-cert-manage-btns").style.display="none",document.getElementById("us-div-cloud-manage-btns").style.display="none",document.getElementById("us-fieldset-cert-manage-title").appendChild(document.createTextNode(b.IDS_DETAIL_BOX_TITLE)),k&&-1<k.selectedIndex()?(c=parseInt(k.selectedIndex()),d=a.certsList.list[c-1].path,a.usWebToolkit.x509Certificate.parser(a.certsList.list[c-1].cert,"Base64"),document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b>"+a.certUtil().getCN(a.usWebToolkit.x509Certificate.getSubjectName())+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-data").innerHTML=a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotBefore())+" ~ "+a.certUtil().getLocalDate(a.usWebToolkit.x509Certificate.getNotAfter()),document.getElementById("us-layout-cert-manage-detail-box-savepath-data").innerHTML=d,document.getElementById("us-layout-cert-manage-detail-box-savepath-data").setAttribute("title",d)):document.getElementById("us-layout-cert-manage-detail-box-subject").innerHTML="<b style='color: red;'>"+b.IDS_DETAIL_BOX_NOT_SELECTED+"</b>",document.getElementById("us-layout-cert-manage-detail-box-expire-lbl").innerHTML=b.IDS_DETAIL_BOX_EXPIRE_DATE+" : ",document.getElementById("us-layout-cert-manage-detail-box-savepath-lbl").innerHTML=b.IDS_DETAIL_BOX_SAVE_PATH+" : ",c=document.getElementById("us-cert-manage-detail-view-btn"),c.setAttribute("tabindex",w++,0),c.value=b.IDS_DETAIL_BOX_BTN_VIEW,c.title=b.IDS_DETAIL_BOX_BTN_VIEW,c.onclick=function(){h||E(this,b)},c=document.getElementById("us-cert-manage-sw-info-btn"),c.setAttribute("tabindex",w++,0),c.setAttribute("class","btn-action"),c.value=b.IDS_DETAIL_BOX_BTN_ACTIONS[p.args.type],c.title=b.IDS_DETAIL_BOX_BTN_ACTIONS[p.args.type],c.onclick=function(){h||Ia(this,b,function(a,b,c){0==a&&(b&&c?L(b,c):L())})},B(b)):(document.getElementById("us-div-cert-manage-detail").style.display="none",c=document.getElementById("us-cert-manage-cert-view-btn"),c.setAttribute("value",b.IDS_CERT_VIEW,0),c.setAttribute("title",b.IDS_CERT_VIEW+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||E(this,b)},c=document.getElementById("us-cert-manage-pw-change-btn"),c.setAttribute("value",b.IDS_PW_CHANGE,0),c.setAttribute("title",b.IDS_PW_CHANGE+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||ba(this,b)},d=document.getElementById("us-cert-manage-cert-delete-btn"),d.setAttribute("value",b.IDS_CERT_DELETE,0),d.setAttribute("title",b.IDS_CERT_DELETE+b.IDS_BUTTON,0),d.setAttribute("tabindex",w++,0),d.onclick=function(){h||ca(this,b)},d=document.getElementById("us-cert-manage-cert-copy-btn"),d.setAttribute("value",b.IDS_CERT_COPY,0),d.setAttribute("title",b.IDS_CERT_COPY+b.IDS_BUTTON,0),d.setAttribute("tabindex",w++,0),d.onclick=function(){h||aa(this,b)},"MPKI"==a.ESVS.PKI&&(d.readOnly=!0,d.disabled=!0,c.readOnly=!0,c.disabled=!0),a.uiUtil().isIraq()&&(d.readOnly=!0,d.disabled=!0),c=document.getElementById("us-cert-manage-get-cert-btn"),c.setAttribute("value",b.IDS_CERT_GET,0),c.setAttribute("title",b.IDS_CERT_GET+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||S(b)},c=document.getElementById("us-cert-manage-put-cert-out-btn"),c.setAttribute("value",b.IDS_CERT_PUT_OUT,0),c.setAttribute("title",b.IDS_CERT_PUT_OUT+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||ea(this,b)},c=document.getElementById("us-cert-manage-sw-info-btn"),c.setAttribute("value",b.IDS_SW_INFO,0),c.setAttribute("title",b.IDS_SW_INFO+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||sa(this)},c=document.getElementById("us-cloud-manage-pin-change-btn"),c.setAttribute("value",b.IDS_CLOUD_PIN_CHANGE,0),c.setAttribute("title",b.IDS_CLOUD_PIN_CHANGE+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||Y(b)},c=document.getElementById("us-cloud-manage-delete-btn"),c.setAttribute("value",b.IDS_CLOUD_DELETE,0),c.setAttribute("title",b.IDS_CLOUD_DELETE+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||ma(b)},c=document.getElementById("us-cloud-manage-unlock-btn"),c.setAttribute("value",b.IDS_CLOUD_UNLOCK_CERT,0),c.setAttribute("title",b.IDS_CLOUD_UNLOCK_CERT+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||na(b)},c=document.getElementById("us-cloud-manage-get-cert-btn"),c.setAttribute("value",b.IDS_CLOUD_UPLOAD,0),c.setAttribute("title",b.IDS_CLOUD_UPLOAD+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||S(b)},c=document.getElementById("us-cloud-manage-put-cert-btn"),c.setAttribute("value",b.IDS_CLOUD_EXPORT,0),c.setAttribute("title",b.IDS_CLOUD_EXPORT+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||oa(b)},c=document.getElementById("us-cloud-manage-cert-history-btn"),c.setAttribute("value",b.IDS_CLOUD_CERT_HISTORY,0),c.setAttribute("title",b.IDS_CLOUD_CERT_HISTORY+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||pa(b)},c=document.getElementById("us-cloud-manage-disconnect-btn"),c.setAttribute("value",b.IDS_CLOUD_DISCONNECT,0),c.setAttribute("title",b.IDS_CLOUD_DISCONNECT+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||qa(b)},c=document.getElementById("us-cloud-manage-delete-auto-connect-btn"),c.setAttribute("value",b.IDS_CLOUD_DELETE_AUTO_CONNECT,0),c.setAttribute("title",b.IDS_CLOUD_DELETE_AUTO_CONNECT+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||ra(b)},c=document.getElementById("us-cloud-manage-delete-account-btn"),c.setAttribute("value",b.IDS_CLOUD_DELETE_ACCOUNT,0),c.setAttribute("title",b.IDS_CLOUD_DELETE_ACCOUNT+b.IDS_BUTTON,0),c.setAttribute("tabindex",w++,0),c.onclick=function(){h||confirm(b.IDS_CONFIRMBOX_WARNING_DELETE_ACCOUNT)&&a.CLOUD.deleteAccount(function(a){0!=a.resultCode?alert(b.IDS_MSGBOX_CLOUD_DELETE_ACCOUNT):alert(a.resultMessage)})});c=document.getElementById("us-cert-manage-lbl-notice");c.appendChild(document.createTextNode(b.IDS_NOTICE));if("MPKI"==a.ESVS.PKI||a.uiUtil().isIraq())c.style.visibility="hidden";var t=document.getElementById("us-cert-manage-cls-btn");t.setAttribute("value",b.IDS_CLOSE,0);t.setAttribute("title",b.IDS_CLOSE+b.IDS_BUTTON,0);t.setAttribute("tabindex",w++,0);t.onclick=function(){h&&a.ESVS.chkEXESetup||L()};g=document.getElementById("us-cert-manage-cls-btn-img");t.onkeydown=function(a){a=a||window.event;var b=a.which||a.keyCode;9==b&&a.shiftKey&&(t.onblur=function(){setTimeout(function(){document.getElementById("us-cert-manage-sw-info-btn").focus()},10)});9!=b||a.shiftKey||(t.onblur=function(){setTimeout(function(){g.focus()},10)})};var u=!1;g.onkeyup=function(a){a=a||window.event;9==(a.which||a.keyCode)&&a.shiftKey&&u&&(u=!1,setTimeout(function(){t.focus()},10))};g.onkeydown=function(a){a=a||window.event;if(9==(a.which||a.keyCode)&&a.shiftKey)return a.cancelBubble=!0,u=a.returnValue=!0,!1};a.ESVS.ShowGuide&&C(m);return document.getElementById("us-div-cert-manage")}()};return function(p){var y=a.uiLayerLevel,x=a.uiUtil().getOverlay(y),E=Y({type:p.type,args:p.args,onConfirm:p.onConfirm,onCancel:p.onCancel});E.style.zIndex=y+1;document.body.insertBefore(x,document.body.firstChild);var U=window.onresize;return{show:function(){draggable(E,document.getElementById("us-div-cert-manage-title"));x.style.display="block";a.uiUtil().offsetResize(E);window.onresize=function(){a.uiUtil().offsetResize(E)};a.uiLayerLevel+=10;a.ESVS.TabIndex+=30;setTimeout(function(){a:{for(var p=a.ESVS.Media.list.split("|"),x=0;x<p.length;x++){var y=a.CONST.medias[p[x]];if(void 0!=y&&null!=y&&(y=document.getElementById("us-cert-manage-btn-"+y.name))&&"us-layout-storage-btn-on"==y.className){y.focus();break a}}a.uiUtil().setFirstFocus("us-cert-manage-cls-btn-img")}},10)},hide:function(){x.style.display="none";E.style.display="none"},dispose:function(p){1==p&&4&a.ESVS.Mode&&a.ESVS.chkEXESetup&&a.nimservice().ClearAllUserCertList(function(a,p){});window.onresize=function(){U&&U()};E.parentNode.removeChild(E);x.parentNode.removeChild(x);a.uiLayerLevel-=10;a.ESVS.TabIndex-=30}}}};