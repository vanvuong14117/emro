var __crosscertlocalstorage=function(t){function g(c,b,a){var d=JSON.parse(c),e={};e.messageNumber=b;e.operation=d.operation;e.certIdentifier=d.certIdentifier?d.certIdentifier:"";e.callback=a;e.valid=!0;10<=l&&(l=0);k[l]=e;l+=1;f+=1;try{document.getElementById("shareframe").contentWindow.postMessage(c,u)}catch(w){null!=a&&a(-1)}}function q(){n--;"function"===typeof window.addEventListener?window.removeEventListener("message",m,!1):window.detachEvent("onmessage",m)}function r(){0<n&&q();"function"===typeof window.addEventListener?window.addEventListener("message",m,!1):window.attachEvent("onmessage",m);n++}var f=0,h=Math.random();ccoperation="GetVersion GetStorageHandler GetCertificateList SaveUserCert SetP12OnMemory DeleteUserCertByIndex IsAvaliable GetP12ForBuToPc GetP12ForBuToMo DeleteUserCertByDN SetP12HexOnMemory".split(" ");var p=!1,d="",e="",l=0,k=[],u=t.ESVS.SHARESTORAGE,n=0,m=function(c){p=!0;if(!(null==c.data||0>=c.data.length)){var b=null,a=null;try{a=JSON.parse(c.data)}catch(v){return}for(c=0;c<k.length;c++)if(k[c].messageNumber==a.messageNumber){if(0==k[c].valid){k[c].callback(-1);return}b=k[c].callback;k[c]=0;break}a.operation==ccoperation[0]?(currentVersion=a.list?a.list[0].version:a.version,a=currentVersion.split("."),currentVersion=a[0]+"."+a[1]+"."+a[2]+".0",b&&b(currentVersion)):a.operation==ccoperation[1]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,0)):b(a.resultCode,a.PFSH):a.operation==ccoperation[2]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,0)):b(a.resultCode,a.userCerts):a.operation==ccoperation[3]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,0)):b(a.resultCode,a.resultMessage):a.operation==ccoperation[4]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage,a.userCertsInfo):a.operation==ccoperation[5]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage):a.operation==ccoperation[6]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage):a.operation==ccoperation[7]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage,a.dn,a.p12):a.operation==ccoperation[8]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage,a.p12key,a.p12):a.operation==ccoperation[9]?0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage):a.operation==ccoperation[10]&&(0!=a.resultCode?(d=a.resultCode,e=a.resultMessage,b(d,e)):b(a.resultCode,a.resultMessage,a.userCertsInfo))}};r();return{Version:function(c){},GetLastErrorCode:function(){return d},GetLastErrorMessage:function(){return e},IsAvailable:function(){return p},GetIframeLoaded:function(){return p},IsCCPFSHAvailable:function(c){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[6]}),f,c)},GetCCStorageHandler:function(c,b,a,d){q();r();g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[1],enc_algo:c,hash_algo:b,pki:a}),f,d)},SaveUserCert:function(c,b,a,d){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[3],caname:c,usercert:b,checkExist:a}),f,d)},GetCertificateList:function(c){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[2]}),f,c)},SetP12OnMemory:function(c,b,a){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[4],fileB64Bin:c,pw:b}),f,a)},DeleteUserCertByIndex:function(c,b){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[5],index:c}),f,b)},GetP12ForBuToPc:function(c,b,a,d){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[7],index:c,pw:b,retType:a}),f,d)},GetP12ForBuToMo:function(c,b,a){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[8],index:c,encoding:b}),f,a)},DeleteUserCertByDN:function(c,b,a,d){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[9],ca:c,dn:b,pw:a}),f,d)},SetP12HexOnMemory:function(c,b,a){g(JSON.stringify({messageNumber:f,sessionID:""+h,operation:ccoperation[10],p12Hex:c,p12Hexkey:b}),f,a)}}};